{"componentChunkName":"component---src-templates-blog-post-js","path":"/2024/aws-gh-actions/","result":{"data":{"site":{"siteMetadata":{"title":"5π Consulting","author":"Johannes 'fish' Ziemke"}},"markdownRemark":{"id":"7be57a08-6e76-5be4-a89f-af60d9d824b2","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/449660d77db3582bdcb12c4b91aff5d0/91298/cerberus.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.05521472392638%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRo4AAABXRUJQVlA4IIIAAABQBACdASoUAAsAPtFUo0uoJKMhsAgBABoJZACdAYv0zv0/JT8wkRYjpMxAAP7vYozH0b2fO3Va34VSqGW9wlGKarDLmLQNwg8IMXuH9PcTT78rbIFj0FqtUuIzBLsJAoeJJk9DqdEyHGIXcUhE9kMZvXaABamsLaDQ5r8knZlJgAAA'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cerberus/OIDC validating Herculus&#39; Cloud Access. Thanks DALL-E!\"\n        title=\"\"\n        src=\"/static/449660d77db3582bdcb12c4b91aff5d0/c1dc5/cerberus.webp\"\n        srcset=\"/static/449660d77db3582bdcb12c4b91aff5d0/94563/cerberus.webp 163w,\n/static/449660d77db3582bdcb12c4b91aff5d0/647a8/cerberus.webp 325w,\n/static/449660d77db3582bdcb12c4b91aff5d0/c1dc5/cerberus.webp 650w,\n/static/449660d77db3582bdcb12c4b91aff5d0/1e975/cerberus.webp 975w,\n/static/449660d77db3582bdcb12c4b91aff5d0/063bf/cerberus.webp 1300w,\n/static/449660d77db3582bdcb12c4b91aff5d0/91298/cerberus.webp 1792w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"intro\" style=\"position:relative;\"><a href=\"#intro\" aria-label=\"intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Intro</h1>\n<p>Most companies and projects these days use some form of CI/CD to automatically build artifacts like binaries or container images when new code is pushed to a repository. Commonly this involves:</p>\n<ul>\n<li>Configuring where to push and how to name the artifacts in a config file in the repository</li>\n<li>Granting the build server permissions to your artifact store by configuring some secrets</li>\n</ul>\n<p>To prevent a developer from modifying production artifacts, it’s common to prevent them from merging changes without review. For GitHub Actions this can be achieved using <a href=\"https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/managing-a-branch-protection-rule\">branch protection rules</a></p>\n<p>Still, users can modify the workflow in their own branch and extract the build secret or use it to overwrite e.g production artifacts, bypassing code review requirements.</p>\n<p>While with GitHub Actions it’s possible to <a href=\"https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment\">use environments</a> to make secrets only available to certain, e.g main branches and have separate artifact stores or accounts for development and production, overwriting or creating undesired artifacts can’t be prevented this way.</p>\n<p>Fortunately, there are more secure methods that also eliminate the need for managing and rotating secrets and ensure branches can only create artifacts that adhere to a naming convention that prevents this.</p>\n<p>When a client asked me to migrate their legacy CircleCI container build setup to GitHub Actions, we took the opportunity to implement this.</p>\n<h1 id=\"goals-and-conventions\" style=\"position:relative;\"><a href=\"#goals-and-conventions\" aria-label=\"goals and conventions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Goals and Conventions</h1>\n<p>The goals were to use GitHub Actions with Branch Protection rules that require review of all changes to the main branch.\nThe container images are to be pushed to <a href=\"https://aws.amazon.com/ecr/\">AWS ECR</a> and that configuration is managed using <a href=\"https://www.terraform.io/\">terraform</a>.</p>\n<p>Beyond that, we wanted to ensure that container images will always be tagged with the git sha and no other tags are possible. My client had more nuanced tagging requirements but for the sake of simplicity let’s assume this.</p>\n<h1 id=\"basic-setup\" style=\"position:relative;\"><a href=\"#basic-setup\" aria-label=\"basic setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Basic Setup</h1>\n<p>To implement these goals, we’re using OpenID Connect to configure AWS ECR to trust GitHub’s OIDC provider.</p>\n<h2 id=\"openid-connect-oidc\" style=\"position:relative;\"><a href=\"#openid-connect-oidc\" aria-label=\"openid connect oidc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenID Connect (OIDC)</h2>\n<p>OIDC is a protocol to extend OAuth 2.0 to enable applications to verify user identity. For this purpose, it uses <a href=\"https://en.wikipedia.org/wiki/JSON_Web_Token\">JSON Web Tokens</a> to represent “claims” between two parties.</p>\n<h2 id=\"ecr-configuration\" style=\"position:relative;\"><a href=\"#ecr-configuration\" aria-label=\"ecr configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ECR Configuration</h2>\n<p>To configure ECR to trust GitHub’s OIDC provider, we first need to configure the <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_oidc.html\">OIDC identity provider</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_iam_openid_connect_provider\"</span></span> <span class=\"token string\">\"github\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">url</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"https://token.actions.githubusercontent.com\"</span>\n  <span class=\"token property\">client_id_list</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"sts.amazonaws.com\"</span>\n  <span class=\"token punctuation\">]</span>\n  <span class=\"token property\">thumbprint_list</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"6938fd4d98bab03faadb97b34396831e3780aea1\"</span>,\n    <span class=\"token string\">\"1c58a3a8518e8759bf075b76b750d4f2df264fcd\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">url</code> configures the base URL of the OIDC provider. The standardized endpoint <a href=\"https://token.actions.githubusercontent.com/.well-known/openid-configuration\"><code class=\"language-text\">.well-known/openid-configuration</code></a> configures the JSON Web Key Sets, a list of public keys used to verify the JWTs issued by the OIDC Provider, as well as supported claims, response and subject types.</p>\n<p>AWS supports a <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers.html\">federated principal</a> in IAM roles to allow a role to be assumed using JWTs issued by a OIDC provider:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_iam_role\"</span></span> <span class=\"token string\">\"github-action-repo-access\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"github-ecr-access\"</span>\n  <span class=\"token property\">assume_role_policy</span> <span class=\"token punctuation\">=</span> jsonencode(<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">Version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"2012-10-17\"</span>\n    <span class=\"token property\">Statement</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">Action</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"sts:AssumeRoleWithWebIdentity\"</span>\n        <span class=\"token property\">Effect</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Allow\"</span>\n        <span class=\"token property\">Principal</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">Federated</span> <span class=\"token punctuation\">=</span> aws_iam_openid_connect_provider.github.arn\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token property\">Condition</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">StringEquals</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"token.actions.githubusercontent.com:aud\"</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"sts.amazonaws.com\"</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token property\">StringLike</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"token.actions.githubusercontent.com:sub\"</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"repo:org/repo:*\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>)\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The assume_role_policy here has two conditions:</p>\n<ul>\n<li><code class=\"language-text\">aud</code>: The “Audience” claim, needs to be to set <code class=\"language-text\">sts.amazonaws.com</code> when using the <a href=\"https://github.com/aws-actions/configure-aws-credentials\">official configure-aws-credentials action</a></li>\n<li><code class=\"language-text\">sub</code>: The “Subject” claim is set by GitHub’s OIDC provider to a <a href=\"https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#example-subject-claims\">concatenation of metadata about the workflow</a></li>\n</ul>\n<p>In this case, the <code class=\"language-text\">sub</code> condition will ensure that this role can only be assumed when the workflow originated from a repo <code class=\"language-text\">org/repo</code>.</p>\n<p>The remaining configuration is pretty standard:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">data <span class=\"token type variable\">\"aws_iam_policy_document\"</span></span> <span class=\"token string\">\"github-action-repo-access\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">statement</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">effect</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Allow\"</span>\n\n    <span class=\"token property\">actions</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"ecr:GetAuthorizationToken\"</span>\n    <span class=\"token punctuation\">]</span>\n\n    <span class=\"token property\">resources</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">statement</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">effect</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Allow\"</span>\n\n    <span class=\"token property\">actions</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"ecr:BatchGetImage\"</span>,\n      <span class=\"token string\">\"ecr:BatchCheckLayerAvailability\"</span>,\n      <span class=\"token string\">\"ecr:CompleteLayerUpload\"</span>,\n      <span class=\"token string\">\"ecr:GetDownloadUrlForLayer\"</span>,\n      <span class=\"token string\">\"ecr:InitiateLayerUpload\"</span>,\n      <span class=\"token string\">\"ecr:PutImage\"</span>,\n      <span class=\"token string\">\"ecr:UploadLayerPart\"</span>\n    <span class=\"token punctuation\">]</span>\n\n    <span class=\"token property\">resources</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"arn:aws:ecr:<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">aws_ecr_region</span><span class=\"token punctuation\">}</span></span>:<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">aws_ecr_account</span><span class=\"token punctuation\">}</span></span>:repo/*\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_iam_policy\"</span></span> <span class=\"token string\">\"github-action-repo-access\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">policy</span> <span class=\"token punctuation\">=</span> data.aws_iam_policy_document.github-action-repo-access.json\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_iam_role_policy_attachment\"</span></span> <span class=\"token string\">\"github-action-repo-access\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">role</span>       <span class=\"token punctuation\">=</span> aws_iam_role.github-action-repo-access.name\n  <span class=\"token property\">policy_arn</span> <span class=\"token punctuation\">=</span> aws_iam_policy.github-action-repo-access.arn\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"configuring-github-action-workflow\" style=\"position:relative;\"><a href=\"#configuring-github-action-workflow\" aria-label=\"configuring github action workflow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuring GitHub Action Workflow</h2>\n<p>Now you can create a GitHub Workflow that assumes the role and logs into ECR without providing any secrets to GitHub:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push container image\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">AWS_REGION</span><span class=\"token punctuation\">:</span> us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n  <span class=\"token key atrule\">AWS_ACCOUNT_ID</span><span class=\"token punctuation\">:</span> &lt;account id<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">AWS_ECR_REPO</span><span class=\"token punctuation\">:</span> amazonaws.com/&lt;repo<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">permissions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">id-token</span><span class=\"token punctuation\">:</span> write   <span class=\"token comment\"># This is required for requesting the JWT</span>\n  <span class=\"token key atrule\">contents</span><span class=\"token punctuation\">:</span> read    <span class=\"token comment\"># This is required for actions/checkout</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build-and-push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> configure aws credentials\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>actions/configure<span class=\"token punctuation\">-</span>aws<span class=\"token punctuation\">-</span>credentials@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">role-to-assume</span><span class=\"token punctuation\">:</span> arn<span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">:</span>iam<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> env.AWS_ACCOUNT_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>role/github<span class=\"token punctuation\">-</span>ecr<span class=\"token punctuation\">-</span>access\n          <span class=\"token key atrule\">role-session-name</span><span class=\"token punctuation\">:</span> github<span class=\"token punctuation\">-</span>ecr\n          <span class=\"token key atrule\">aws-region</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> env.AWS_REGION <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to Amazon ECR\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>actions/amazon<span class=\"token punctuation\">-</span>ecr<span class=\"token punctuation\">-</span>login@v1\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> .\n          <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ${{\n              format('{0}.dkr.ecr.{1}.{2}/{3}:{4}',\n              env.AWS_ACCOUNT_ID,\n              env.AWS_REGION,\n              env.AWS_ECR_REPO,\n              github.repository,\n              github.sha)\n            }}</span>\n</code></pre></div>\n<h1 id=\"hardening--reusability\" style=\"position:relative;\"><a href=\"#hardening--reusability\" aria-label=\"hardening  reusability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hardening &#x26; Reusability</h1>\n<p>While we solved the shared secret issue, so far nothing prevents a developer from modifying the workflow in their branch and overwrite other ECR images.\nTo fix this and ensure consistent naming while also making our workflow reusable, we’ll make the <a href=\"https://docs.github.com/en/actions/using-workflows/reusing-workflows\">workflow resuable</a> by moving it to a separate <code class=\"language-text\">gh-actions</code> repository and changing the trigger to <a href=\"https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_call\">on workflow_call</a>:</p>\n<h2 id=\"make-workflow-resuable\" style=\"position:relative;\"><a href=\"#make-workflow-resuable\" aria-label=\"make workflow resuable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Make workflow resuable</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># &lt;org>/gh-actions/.github/workflows/build-and-push.yaml</span>\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push container image\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">workflow_call</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">AWS_REGION</span><span class=\"token punctuation\">:</span> us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n  <span class=\"token key atrule\">AWS_ACCOUNT_ID</span><span class=\"token punctuation\">:</span> &lt;account id<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">AWS_ECR_REPO</span><span class=\"token punctuation\">:</span> amazonaws.com/&lt;repo<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">permissions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">id-token</span><span class=\"token punctuation\">:</span> write   <span class=\"token comment\"># This is required for requesting the JWT</span>\n  <span class=\"token key atrule\">contents</span><span class=\"token punctuation\">:</span> read    <span class=\"token comment\"># This is required for actions/checkout</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build-and-push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> configure aws credentials\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>actions/configure<span class=\"token punctuation\">-</span>aws<span class=\"token punctuation\">-</span>credentials@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">role-to-assume</span><span class=\"token punctuation\">:</span> arn<span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">:</span>iam<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> env.AWS_ACCOUNT_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>role/github<span class=\"token punctuation\">-</span>ecr<span class=\"token punctuation\">-</span>access\n          <span class=\"token key atrule\">role-session-name</span><span class=\"token punctuation\">:</span> github<span class=\"token punctuation\">-</span>ecr\n          <span class=\"token key atrule\">aws-region</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> env.AWS_REGION <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to Amazon ECR\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>actions/amazon<span class=\"token punctuation\">-</span>ecr<span class=\"token punctuation\">-</span>login@v1\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> .\n          <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ${{\n              format('{0}.dkr.ecr.{1}.{2}/{3}:{4}',\n              env.AWS_ACCOUNT_ID,\n              env.AWS_REGION,\n              env.AWS_ECR_REPO,\n              github.repository,\n              github.sha)\n            }}</span></code></pre></div>\n<p>“This is a minimal example. Once created, it can be extended to conditionally produce different tags for various branches, such as production, version, or release branches.</p>\n<p>Now this workflow can be called from the source repository like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build-and-push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> &lt;org<span class=\"token punctuation\">></span>/gh<span class=\"token punctuation\">-</span>actions/.github/workflows/build<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>push.yaml@main</code></pre></div>\n<p>The <code class=\"language-text\">@main</code> will ensure that always the workflow from the main branch is used. Enabling branch protection for the main branch in the <code class=\"language-text\">gh-actions</code> repo will prevent developers from modifying the workflow without going through code review.</p>\n<p>This makes the workflow reusable and ensures images are always tagged the same way; however, it still doesn’t prevent a developer from assuming the role and using that for arbitrary ECR actions. For this we need to change the assume role policy of the federated IAM role.</p>\n<h2 id=\"modify-assume-role-policy-to-only-allow-reusable-workflow\" style=\"position:relative;\"><a href=\"#modify-assume-role-policy-to-only-allow-reusable-workflow\" aria-label=\"modify assume role policy to only allow reusable workflow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Modify Assume Role Policy to only allow reusable workflow</h2>\n<p>During the workflow run, GitHub’s OIDC provider sets the <code class=\"language-text\">sub</code> claim to the repo the workflow originates on. We used that to allow only that repo to assume the role. When using a reusable workflow, though, an additional claim called job_workflow_ref is set. Unfortunately <a href=\"https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services#overview\">AWS doesn’t support custom claims</a> as of today. Otherwise we could simply replace our <code class=\"language-text\">token.actions.githubusercontent.com:sub = \"repo:org/repo:*\"</code> condition by a <code class=\"language-text\">job_workflow_ref</code> based one.\nFortunately it’s possible to <a href=\"https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#customizing-the-subject-claims-for-an-organization-or-repository\">modify what GitHub sets as standard <code class=\"language-text\">sub</code> claim</a>.</p>\n<p>Despite the apparent common requirement for this, there seems to be no web ui option. Instead a <a href=\"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens\">personal access token</a> needs to be created to use the API directly:</p>\n<p>To allow us to build conditions for other claims we’re using the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span><span class=\"token property\">\"include_claim_keys\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"repo\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"context\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"job_workflow_ref\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>This can be set as an org-wide default for new repositories like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-X</span> PUT <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Accept: application/vnd.github+json\"</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer &lt;YOUR-GH-PAT>\"</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"X-GitHub-Api-Version: 2022-11-28\"</span> <span class=\"token punctuation\">\\</span>\n  https://api.github.com/orgs/<span class=\"token operator\">&lt;</span>org<span class=\"token operator\">></span>/actions/oidc/customization/sub <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-d</span> <span class=\"token string\">'{\"include_claim_keys\":[\"repo\",\"context\",\"job_workflow_ref\"]}'</span></code></pre></div>\n<p>For existing repositories to take effect, it needs to be applied on the repo level as well:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-X</span> PUT <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Accept: application/vnd.github+json\"</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer &lt;YOUR-GH-PAT>\"</span><span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"X-GitHub-Api-Version: 2022-11-28\"</span> <span class=\"token punctuation\">\\</span>\n  https://api.github.com/repos/<span class=\"token operator\">&lt;</span>org<span class=\"token operator\">></span>/<span class=\"token operator\">&lt;</span>repo<span class=\"token operator\">></span>/actions/oidc/customization/sub <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-d</span> <span class=\"token string\">'{\"use_default\":false,\"include_claim_keys\":[\"repo\",\"context\",\"job_workflow_ref\"]}'</span></code></pre></div>\n<p>Now the <code class=\"language-text\">sub</code> claim presented by the OIDC provider will be set to <code class=\"language-text\">repo:&lt;orgName/repoName>:environment:&lt;environmentName>:job_workflow_ref:&lt;reusableWorkflowPath></code>.</p>\n<p>This allows us to update the Assume Role Policy as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_iam_role\"</span></span> <span class=\"token string\">\"github-action-repo-access\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"github-ecr-access\"</span>\n  <span class=\"token property\">assume_role_policy</span> <span class=\"token punctuation\">=</span> jsonencode(<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">Version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"2012-10-17\"</span>\n    <span class=\"token property\">Statement</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">Action</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"sts:AssumeRoleWithWebIdentity\"</span>\n        <span class=\"token property\">Effect</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Allow\"</span>\n        <span class=\"token property\">Principal</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">Federated</span> <span class=\"token punctuation\">=</span> aws_iam_openid_connect_provider.github.arn\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token property\">Condition</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">StringEquals</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"token.actions.githubusercontent.com:aud\"</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"sts.amazonaws.com\"</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token property\">StringLike</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"token.actions.githubusercontent.com:sub\"</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"repo:&lt;org>/*:*:job_workflow_ref:&lt;org>/gh-actions/.github/workflows/build-and-push.yaml@refs/heads/main\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>)\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now the role can only be assumed by steps that are part of the the reusable workflow in the main branch and originate from a repo in <code class=\"language-text\">&lt;org></code>.</p>\n<h1 id=\"recap\" style=\"position:relative;\"><a href=\"#recap\" aria-label=\"recap permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recap</h1>\n<p>This configuration implements the desired goals:</p>\n<ul>\n<li>On push the reusable workflow is checked out</li>\n<li>The reusable workflow uses <code class=\"language-text\">configure-aws-credentials</code> to retrieve short-lived credentials using OIDC</li>\n<li>The Assume Role Policy allows only workflows using the resuable workflow to assume the role, so while a user might attempt to call <code class=\"language-text\">configure-aws-credentials</code> directly or a branch of the <code class=\"language-text\">gh-actions</code> repo that they control, the role can only be assumed by using the workflow from the <code class=\"language-text\">main</code> branch</li>\n<li>There are no manually configured secrets involved, once configured there is no maintainance or rotation of secrets required</li>\n</ul>\n<h1 id=\"common-issues\" style=\"position:relative;\"><a href=\"#common-issues\" aria-label=\"common issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Common Issues</h1>\n<p>While granting ECR access from GitHub Actions using this approach seems to be the most sensible one, it’s quite complex and it’s configuration error prone,\nchecking AWS Cloudtrail to debug claims maching the StringLike conditions was very useful. You can find it in the AWS Console here:</p>\n<ul>\n<li><a href=\"https://us-east-1.console.aws.amazon.com/cloudtrail/home?region=us-east-1#/events?EventName=AssumeRoleWithWebIdentity\">https://us-east-1.console.aws.amazon.com/cloudtrail/home?region=us-east-1#/events?EventName=AssumeRoleWithWebIdentity</a></li>\n</ul>","frontmatter":{"title":"Build securely with Github Actions and ECR using OpenID Connect","date":"February 05, 2024","image":{"childImageSharp":{"fixed":{"base64":"data:image/webp;base64,UklGRuYAAABXRUJQVlA4INoAAABwBQCdASoUABQAPtFep0+oJKMiKAgBABoJYgC7L6AVd8YSr++jRHhdbmk8oc38rmHuat9AAP7c8yOsgwiollLpfdPmXS+h2Cp6eUU7nAynadoiI+5GfL0bR2PKB5zZJHT5zHq7OOkkoIGhuaMg60Nfk2sB8+kqRwoj0WomjG9eq9kOoAvP+mnuqsnwD0ZbwK7VDzZmgm1dcnuqaTbn5KYKdgsoh9RgGRYAIMug2QuPd05y3lpymSCkNtTqYs/87XNo5myfUexArVkvMlZRwIQWM4Ui2D3gAAAAAA==","width":1200,"height":1200,"src":"/static/449660d77db3582bdcb12c4b91aff5d0/b395e/cerberus.webp","srcSet":"/static/449660d77db3582bdcb12c4b91aff5d0/b395e/cerberus.webp 1x"}}}}}},"pageContext":{"slug":"/2024/aws-gh-actions/","previous":{"fields":{"slug":"/2021/05/11/homelab-upgrades-hardware/"},"frontmatter":{"title":"Kubernetes at Home: Hardware"}},"next":{"fields":{"slug":"/case-studies/styla/"},"frontmatter":{"title":"Styla: Content Experience Engine"}}}},"staticQueryHashes":[],"slicesMap":{}}
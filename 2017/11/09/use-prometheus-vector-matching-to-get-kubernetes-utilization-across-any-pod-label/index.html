<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-bb0078f6fed199dc13ad.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-4fda7d55e9794dbb1ab9.js" as="script"/><link rel="preload" href="/path---2017-11-09-use-prometheus-vector-matching-to-get-kubernetes-utilization-across-any-pod-label-0f18eef791eb11be0317.js" as="script"/><link rel="preload" href="/app-c50d81e93841ea8bc545.js" as="script"/><link rel="preload" href="/commons-03554c3de8e6350a1b07.js" as="script"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">Use Prometheus Vector Matching to get Kubernetes Utilization across any Pod Label | 5π - fish&#x27;s blog</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style id="gatsby-inlined-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100.50d27986.woff2) format("woff2"),url(/static/montserrat-latin-100.5e334eff.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic.8c070533.woff2) format("woff2"),url(/static/montserrat-latin-100italic.03e19243.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200.4343d3d9.woff2) format("woff2"),url(/static/montserrat-latin-200.f2022ecd.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic.116c4c4b.woff2) format("woff2"),url(/static/montserrat-latin-200italic.89614a60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300.d2ad295b.woff2) format("woff2"),url(/static/montserrat-latin-300.3a371ee0.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic.f6b6bf24.woff2) format("woff2"),url(/static/montserrat-latin-300italic.16521668.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400.240a8444.woff2) format("woff2"),url(/static/montserrat-latin-400.b20cc131.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic.86172bb8.woff2) format("woff2"),url(/static/montserrat-latin-400italic.9405e787.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500.fb8d6b71.woff2) format("woff2"),url(/static/montserrat-latin-500.50825d47.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic.c0a555a4.woff2) format("woff2"),url(/static/montserrat-latin-500italic.635de59c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600.d5615136.woff2) format("woff2"),url(/static/montserrat-latin-600.f300da4f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic.10f29d13.woff2) format("woff2"),url(/static/montserrat-latin-600italic.2bc37d86.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700.7d77e1f0.woff2) format("woff2"),url(/static/montserrat-latin-700.81826529.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic.1dd2b53f.woff2) format("woff2"),url(/static/montserrat-latin-700italic.c162d257.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800.d4e7bf86.woff2) format("woff2"),url(/static/montserrat-latin-800.895aadbf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic.fc0cbe44.woff2) format("woff2"),url(/static/montserrat-latin-800italic.b3362875.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900.c8bdd772.woff2) format("woff2"),url(/static/montserrat-latin-900.1b99ef78.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic.cb72c1f9.woff2) format("woff2"),url(/static/montserrat-latin-900italic.b78bb9f8.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300.f015f1e9.woff2) format("woff2"),url(/static/merriweather-latin-300.92dfe81b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic.7fd86b32.woff2) format("woff2"),url(/static/merriweather-latin-300italic.878b76f5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400.12dbf4c0.woff2) format("woff2"),url(/static/merriweather-latin-400.1fffad22.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic.1e0d3e81.woff2) format("woff2"),url(/static/merriweather-latin-400italic.de18d4c4.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700.dc8fec81.woff2) format("woff2"),url(/static/merriweather-latin-700.d7d2ed8e.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic.b7b7e5da.woff2) format("woff2"),url(/static/merriweather-latin-700italic.6210a5fc.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900.43f870d5.woff2) format("woff2"),url(/static/merriweather-latin-900.8f3806df.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic.168c1ab2.woff2) format("woff2"),url(/static/merriweather-latin-900italic.ae7778f0.woff) format("woff")}@font-face{font-family:fontello;src:url(/static/fontello.1f1e37ad.eot);src:url(/static/fontello.1f1e37ad.eot#iefix) format("embedded-opentype"),url(/static/fontello.c83454bd.woff2) format("woff2"),url(/static/fontello.a05a3791.woff) format("woff"),url(/static/fontello.cec4b829.ttf) format("truetype"),url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxtZXRhZGF0YT5Db3B5cmlnaHQgKEMpIDIwMTcgYnkgb3JpZ2luYWwgYXV0aG9ycyBAIGZvbnRlbGxvLmNvbTwvbWV0YWRhdGE+CjxkZWZzPgo8Zm9udCBpZD0iZm9udGVsbG8iIGhvcml6LWFkdi14PSIxMDAwIiA+Cjxmb250LWZhY2UgZm9udC1mYW1pbHk9ImZvbnRlbGxvIiBmb250LXdlaWdodD0iNDAwIiBmb250LXN0cmV0Y2g9Im5vcm1hbCIgdW5pdHMtcGVyLWVtPSIxMDAwIiBhc2NlbnQ9Ijg1MCIgZGVzY2VudD0iLTE1MCIgLz4KPG1pc3NpbmctZ2x5cGggaG9yaXotYWR2LXg9IjEwMDAiIC8+CjxnbHlwaCBnbHlwaC1uYW1lPSJ0d2l0dGVyIiB1bmljb2RlPSImI3hmMDk5OyIgZD0iTTkwNCA2MjJxLTM3LTU0LTkwLTkzIDAtOCAwLTIzIDAtNzMtMjEtMTQ1dC02NC0xMzktMTAzLTExNy0xNDQtODItMTgxLTMwcS0xNTEgMC0yNzYgODEgMTktMiA0My0yIDEyNiAwIDIyNCA3Ny01OSAxLTEwNSAzNnQtNjQgODlxMTktMyAzNC0zIDI0IDAgNDggNi02MyAxMy0xMDQgNjJ0LTQxIDExNXYycTM4LTIxIDgyLTIzLTM3IDI1LTU5IDY0dC0yMiA4NnEwIDQ5IDI1IDkxIDY4LTgzIDE2NC0xMzN0MjA4LTU1cS01IDIxLTUgNDEgMCA3NSA1MyAxMjd0MTI3IDUzcTc5IDAgMTMyLTU3IDYxIDEyIDExNSA0NC0yMS02NC04MC0xMDAgNTIgNiAxMDQgMjh6IiBob3Jpei1hZHYteD0iOTI4LjYiIC8+Cgo8Z2x5cGggZ2x5cGgtbmFtZT0iZ2l0aHViLWNpcmNsZWQiIHVuaWNvZGU9IiYjeGYwOWI7IiBkPSJNNDI5IDc3OXExMTYgMCAyMTUtNTh0MTU2LTE1NiA1Ny0yMTVxMC0xNDAtODItMjUydC0yMTEtMTU1cS0xNS0zLTIyIDR0LTcgMTdxMCAxIDAgNDN0MCA3NXEwIDU0LTI5IDc5IDMyIDMgNTcgMTB0NTMgMjIgNDUgMzcgMzAgNTggMTEgODRxMCA2Ny00NCAxMTUgMjEgNTEtNCAxMTQtMTYgNS00Ni02dC01MS0yNWwtMjEtMTNxLTUyIDE1LTEwNyAxNXQtMTA4LTE1cS04IDYtMjMgMTV0LTQ3IDIyLTQ3IDdxLTI1LTYzLTUtMTE0LTQ0LTQ4LTQ0LTExNSAwLTQ3IDEyLTgzdDI5LTU5IDQ1LTM3IDUyLTIyIDU3LTEwcS0yMS0yMC0yNy01OC0xMi01LTI1LTh0LTMyLTMtMzYgMTItMzEgMzVxLTExIDE4LTI3IDI5dC0yOCAxNGwtMTEgMXEtMTIgMC0xNi0ydC0zLTcgNS04IDctNmw0LTNxMTItNiAyNC0yMXQxOC0yOWw2LTEzcTctMjEgMjQtMzR0MzctMTcgMzktMyAzMSAxbDEzIDNxMC0yMiAwLTUwdDEtMzBxMC0xMC04LTE3dC0yMi00cS0xMjkgNDMtMjExIDE1NXQtODIgMjUycTAgMTE3IDU4IDIxNXQxNTUgMTU2IDIxNiA1OHogbS0yNjctNjE2cTIgNC0zIDctNiAxLTgtMS0xLTQgNC03IDUtMyA3IDF6IG0xOC0xOXE0IDMtMSA5LTYgNS05IDItNC0zIDEtOSA1LTYgOS0yeiBtMTYtMjVxNiA0IDAgMTEtNCA3LTkgMy01LTMgMC0xMHQ5LTR6IG0yNC0yM3E0IDQtMiAxMC03IDctMTEgMi01LTUgMi0xMSA2LTYgMTEtMXogbTMyLTE0cTEgNi04IDktOCAyLTEwLTR0Ny05cTgtMyAxMSA0eiBtMzUtM3EwIDctMTAgNi05IDAtOS02IDAtNyAxMC02IDkgMCA5IDZ6IG0zMiA1cS0xIDctMTAgNS05LTEtOC04dDEwLTQgOCA3eiIgaG9yaXotYWR2LXg9Ijg1Ny4xIiAvPgoKPGdseXBoIGdseXBoLW5hbWU9ImZhY2Vib29rLW9mZmljaWFsIiB1bmljb2RlPSImI3hmMjMwOyIgZD0iTTgxMCA3NzlxMTkgMCAzMy0xNHQxNC0zNHYtNzYycTAtMjAtMTQtMzR0LTMzLTE0aC0yMTh2MzMzaDExMWwxNiAxMjloLTEyN3Y4M3EwIDMxIDEzIDQ2dDUxIDE2bDY4IDF2MTE1cS0zNSA1LTEwMCA1LTc1IDAtMTIxLTQ0dC00NS0xMjd2LTk1aC0xMTJ2LTEyOWgxMTJ2LTMzM2gtNDExcS0xOSAwLTMzIDE0dC0xNCAzNHY3NjJxMCAyMCAxNCAzNHQzMyAxNGg3NjN6IiBob3Jpei1hZHYteD0iODU3LjEiIC8+Cgo8Z2x5cGggZ2x5cGgtbmFtZT0iZ2l0aHViLXNxdWFyZWQiIHVuaWNvZGU9IiYjeGYzMDA7IiBkPSJNMjkwIDE4MHEyIDQtMiA4LTUgNC04IDEtMi00IDItNyA1LTQgOC0yeiBtLTE2IDIzcS0zIDQtNyAzLTMtMyAwLTcgNC01IDctMyAzIDIgMCA3eiBtLTIzIDIzcTEgMi0zIDQtNCAxLTQtMS0yLTMgMi01IDUtMSA1IDJ6IG0xMi0xM3ExIDAgMSAydC0yIDNxLTQgNC02IDJ0MS02cTMtMyA2LTF6IG00OC00MnExIDQtNSA2LTUgMi03LTItMi00IDUtNiA1LTIgNyAyeiBtMjMtMnEwIDUtNiA1LTYgMC02LTV0Ni00IDYgNHogbTIyIDRxLTEgNC03IDN0LTUtNXExLTUgNi0zdDYgNXogbTM1OCAxNzdxMCAxMTgtODMgMjAydC0yMDIgODQtMjAyLTg0LTg0LTIwMnEwLTkzIDU1LTE2OHQxNDAtMTAzcTEwLTIgMTUgM3Q1IDExcTAgMjktMSA1My0zLTEtOC0ydC0yMC0xLTI3IDMtMjQgMTEtMTcgMjNxLTEzIDMzLTMyIDQxLTEgMS0yIDJsLTUgNXQtMyA1IDIgNCAxMSAycTMgMCA4LTF0MTctOSAxOC0yMHE5LTE1IDIxLTIzdDI0LTggMjIgMiAxNiA1cTQgMjcgMTkgMzktMjggMy00OCAxMHQtNDEgMjItMzEgNDItMTEgNjdxMCA0NCAzMCA3Ny0xNCAzNCAzIDc1IDEwIDQgMzAtNHQzNC0xNmwxNC05cTMzIDkgNzIgOXQ3MS05cTYgNCAxNiAxMHQzMSAxNCAzMiA1cTE2LTQxIDMtNzUgMjktMzMgMjktNzcgMC0zMi04LTU2dC0yMC0zOS0yOS0yNS0zNS0xNC0zOC03cTE5LTE3IDE5LTUzIDAtMjIgMC01MHQtMS0yOHEwLTcgNS0xMXQxNS0zcTg2IDI5IDE0MSAxMDN0NTQgMTY4eiBtMTQzIDI2OHYtNTM2cTAtNjYtNDctMTEzdC0xMTQtNDhoLTUzNXEtNjcgMC0xMTQgNDh0LTQ3IDExM3Y1MzZxMCA2NiA0NyAxMTN0MTE0IDQ4aDUzNXE2NyAwIDExNC00OHQ0Ny0xMTN6IiBob3Jpei1hZHYteD0iODU3LjEiIC8+Cgo8Z2x5cGggZ2x5cGgtbmFtZT0idHdpdHRlci1zcXVhcmVkIiB1bmljb2RlPSImI3hmMzA0OyIgZD0iTTcxNCA1MTBxLTMxLTE0LTY3LTE5IDM4IDIyIDUyIDY1LTM3LTIxLTc1LTI4LTM0IDM2LTg1IDM2LTQ5IDAtODMtMzR0LTM1LTgzcTAtMTYgMy0yNy03MiA0LTEzNSAzN3QtMTA3IDg2cS0xNi0yOC0xNi01OSAwLTY0IDUxLTk4LTI3IDEtNTYgMTV2LTFxMC00MiAyOC03NXQ2OC00MHEtMTYtNS0yOC01LTcgMC0yMiAzIDEyLTM2IDQyLTU5dDY3LTIzcS02NC01MC0xNDUtNTAtMTUgMC0yOCAyIDgyLTUzIDE4MC01MyA2MiAwIDExNyAyMHQ5NCA1MyA2NyA3NiA0MiA5MSAxMyA5NHEwIDEwIDAgMTUgMzUgMjUgNTggNjF6IG0xNDMgMTA4di01MzZxMC02Ni00Ny0xMTN0LTExNC00OGgtNTM1cS02NyAwLTExNCA0OHQtNDcgMTEzdjUzNnEwIDY2IDQ3IDExM3QxMTQgNDhoNTM1cTY3IDAgMTE0LTQ4dDQ3LTExM3oiIGhvcml6LWFkdi14PSI4NTcuMSIgLz4KCjxnbHlwaCBnbHlwaC1uYW1lPSJmYWNlYm9vay1zcXVhcmVkIiB1bmljb2RlPSImI3hmMzA4OyIgZD0iTTY5NiA3NzlxNjcgMCAxMTQtNDh0NDctMTEzdi01MzZxMC02Ni00Ny0xMTN0LTExNC00OGgtMTA0djMzM2gxMTFsMTYgMTI5aC0xMjd2ODNxMCAzMSAxMyA0NnQ1MSAxNmw2OCAxdjExNXEtMzUgNS0xMDAgNS03NSAwLTEyMS00NHQtNDUtMTI3di05NWgtMTEydi0xMjloMTEydi0zMzNoLTI5N3EtNjcgMC0xMTQgNDh0LTQ3IDExM3Y1MzZxMCA2NiA0NyAxMTN0MTE0IDQ4aDUzNXoiIGhvcml6LWFkdi14PSI4NTcuMSIgLz4KPC9mb250Pgo8L2RlZnM+Cjwvc3ZnPg==#fontello) format("svg");font-weight:400;font-style:normal}[class*=" icon-"]:before,[class^=icon-]:before{font-family:fontello;font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-twitter:before{content:"\F099"}.icon-github-circled:before{content:"\F09B"}.icon-facebook-official:before{content:"\F230"}.icon-github-squared:before{content:"\F300"}.icon-twitter-squared:before{content:"\F304"}.icon-facebook-squared:before{content:"\F308"}</style></head><body><div id="___gatsby"><div style="max-width:42rem;margin-left:auto;margin-right:auto;padding:2.625rem 1.3125rem;" data-reactroot="" data-reactid="1" data-react-checksum="-236151796"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:-1.75rem;" data-reactid="2"><a style="box-shadow:none;text-decoration:none;color:inherit;" href="/" data-reactid="3">5π - fish&#x27;s blog</a></h3><div data-reactid="4"><!-- react-empty: 5 --><h1 data-reactid="6">Use Prometheus Vector Matching to get Kubernetes Utilization across any Pod Label</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem;" data-reactid="7">2017-11-08T23:00:00.000Z</p><div data-reactid="8"><p>Prometheus was designed for dynamic environments like Kubernetes. Its powerful
service discovery and query language allows you to answer all kind of questions
that come up while operating a Kubernetes cluster.</p>
<p>This flexibility comes with a somewhat steeper learning curve than some
alternatives and hosted services, with <a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching">Vector
Matching</a>
being one of the more advanced topics.</p>
<p>I’m not going into the details which the excellent <a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching">Prometheus
Documentation</a>
has already covered but walk you through some useful queries to get resource
utilization in a Kubernetes cluster.</p>
<h2>Aggregated memory usage per label</h2>
<p>Kubernetes provides a <code>container_memory_usage_bytes</code> metric reflecting each pods
memory usage, e.g:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>...
container_memory_usage_bytes{beta_kubernetes_io_arch="amd64",beta_kubernetes_io_fluentd_ds_ready="true",beta_kubernetes_io_instance_type="g1-small",beta_kubernetes_io_os="linux",cloud_google_com_gke_nodepool="small-preemptible",cloud_google_com_gke_preemptible="true",container_name="POD",failure_domain_beta_kubernetes_io_region="us-east1",failure_domain_beta_kubernetes_io_zone="us-east1-c",id="/kubepods/burstable/pod13d4221c-c484-11e7-bff5-42010af0018b/67e5bb069ab9881ff8a55b8628ef4935b0d1ace09c18df20db059522bdfd5b7d",image="gcr.io/google_containers/pause-amd64:3.0",instance="gke-latency-at-small-preemptible-0c981b61-9489",job="kubernetes-cadvisor",kubernetes_io_hostname="gke-latency-at-small-preemptible-0c981b61-9489",name="k8s_POD_latency-api-971504058-jzs5h_default_13d4221c-c484-11e7-bff5-42010af0018b_0",namespace="default",pod_name="latency-api-971504058-jzs5h"}	389120
container_memory_usage_bytes{beta_kubernetes_io_arch="amd64",beta_kubernetes_io_fluentd_ds_ready="true",beta_kubernetes_io_instance_type="g1-small",beta_kubernetes_io_os="linux",cloud_google_com_gke_nodepool="small-preemptible",cloud_google_com_gke_preemptible="true",container_name="POD",failure_domain_beta_kubernetes_io_region="us-east1",failure_domain_beta_kubernetes_io_zone="us-east1-c",id="/kubepods/burstable/pod81d0f651-c500-11e7-bff5-42010af0018b/309e05b118e618122c70ccf88538d13ca41c3b5a770d5d67882426854391c23c",image="gcr.io/google_containers/pause-amd64:3.0",instance="gke-latency-at-small-preemptible-0c981b61-9489",job="kubernetes-cadvisor",kubernetes_io_hostname="gke-latency-at-small-preemptible-0c981b61-9489",name="k8s_POD_latency-api-971504058-gszpw_default_81d0f651-c500-11e7-bff5-42010af0018b_0",namespace="default",pod_name="latency-api-971504058-gszpw"}	372736
container_memory_usage_bytes{beta_kubernetes_io_arch="amd64",beta_kubernetes_io_fluentd_ds_ready="true",beta_kubernetes_io_instance_type="g1-small",beta_kubernetes_io_os="linux",cloud_google_com_gke_nodepool="small-preemptible",cloud_google_com_gke_preemptible="true",container_name="latency-api",failure_domain_beta_kubernetes_io_region="us-east1",failure_domain_beta_kubernetes_io_zone="us-east1-c",id="/kubepods/burstable/pod13d4221c-c484-11e7-bff5-42010af0018b/497e6fdf2217771cb3f52e6fef93734d023f0e7f23f92c58d22139fc18dc5f13",image="registry.gitlab.com/latency.at/latencyat@sha256:8ea057e064b64cc9c8459a68ef3f6d0fc26169b4f57aef193831779e1fe713d4",instance="gke-latency-at-small-preemptible-0c981b61-9489",job="kubernetes-cadvisor",kubernetes_io_hostname="gke-latency-at-small-preemptible-0c981b61-9489",name="k8s_latency-api_latency-api-971504058-jzs5h_default_13d4221c-c484-11e7-bff5-42010af0018b_1",namespace="default",pod_name="latency-api-971504058-jzs5h"}	11014144
container_memory_usage_bytes{beta_kubernetes_io_arch="amd64",beta_kubernetes_io_fluentd_ds_ready="true",beta_kubernetes_io_instance_type="g1-small",beta_kubernetes_io_os="linux",cloud_google_com_gke_nodepool="small-preemptible",cloud_google_com_gke_preemptible="true",container_name="latency-api",failure_domain_beta_kubernetes_io_region="us-east1",failure_domain_beta_kubernetes_io_zone="us-east1-c",id="/kubepods/burstable/pod81d0f651-c500-11e7-bff5-42010af0018b/7b438a8e9df0cf1ab29d067fd36c97099f9f5e7e9257f6187c5be6bff846a62c",image="registry.gitlab.com/latency.at/latencyat@sha256:8ea057e064b64cc9c8459a68ef3f6d0fc26169b4f57aef193831779e1fe713d4",instance="gke-latency-at-small-preemptible-0c981b61-9489",job="kubernetes-cadvisor",kubernetes_io_hostname="gke-latency-at-small-preemptible-0c981b61-9489",name="k8s_latency-api_latency-api-971504058-gszpw_default_81d0f651-c500-11e7-bff5-42010af0018b_0",namespace="default",pod_name="latency-api-971504058-gszpw"}	11448320
...</code></pre>
      </div>
<p>Unfortunately it doesn’t contain the pod labels. For that there is the
<code>kube_pod_labels</code> though which includes a static timeseries with all labels and
the pod name. This metric is provided by
<a href="https://github.com/kubernetes/kube-state-metrics">kube-state-metrics</a>.</p>
<p>We can use it to look up the labels for the pod from the
timeseries (<code>pod_name="latency-api-971504058-jzs5h"</code>):</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>kube_pod_labels{instance="10.116.0.12:8080",job="kubernetes-service-endpoints",k8s_app="kube-state-metrics",kubernetes_name="kube-state-metrics",kubernetes_namespace="kube-system",label_app="latency-api",label_pod_template_hash="971504058",namespace="default",pod="latency-api-971504058-jzs5h"} 1
kube_pod_labels{instance="10.116.1.26:8080",job="kubernetes-service-endpoints",k8s_app="kube-state-metrics",kubernetes_name="kube-state-metrics",kubernetes_namespace="kube-system",label_app="latency-api",label_pod_template_hash="971504058",namespace="default",pod="latency-api-971504058-jzs5h"} 1</code></pre>
      </div>
<p>Both metrics can be merged by using vector matching. We get this metric twice
because there are two instances of kube-state-metrics running. So before we
continue further, we aggregate both. Since they should be identical, we can use
min/max to aggregate. Since we later want to aggregate on <code>label_app</code>, we need
to keep that label. We also need to keep the <code>pod</code> label to join both metrics
on. We can preserve them by specifying them in the BY clause. Since the pod
label is called <code>pod</code> in <code>kube_pod_labels</code> but <code>pod_name</code> in
<code>container_memory_usage_bytes</code>, we need to also use label_replace to rename the
label. This gives us:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>max by (pod_name,label_app) (
  label_replace(kube_pod_labels{label_app!=""},"pod_name","$1","pod","(.*)")
)</code></pre>
      </div>
<p>Which returns something like:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>...
{label_app="latency-api",pod_name="latency-api-971504058-n8k6d"}  1
{label_app="latency-api",pod_name="latency-api-971504058-jzs5h"}  1
...</code></pre>
      </div>
<p>Now we can use vector matching to join <code>container_memory_usage_bytes</code> with the
result of our expression. We use the <code>*</code> operator which effectivly is a no-op
since it will multiply the memory usage by the matched timeseries value in
<code>kube_pod_labels</code> which is always 1.</p>
<p>We need to specify <code>group_left</code> because there are multiple
<code>container_memory_usage_bytes</code> timeseries for each pod, one for each container.
Since we want to preserve the <code>label_app</code> label, we specify it as argument to <code>group_left</code>.</p>
<p>This gives us:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>  container_memory_usage_bytes * on (pod_name) group_left(label_app)
  max by (pod_name,label_app) (
    label_replace(kube_pod_labels{label_app!=""},"pod_name","$1","pod","(.*)")
  )</code></pre>
      </div>
<p>To aggregated the memory usage of all your pods, summed by a <code>k8s-app</code> label you
can use the following expression:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>sum by (label_app,namespace) (
  container_memory_usage_bytes * on (pod_name) group_left(label_app)
  max by (pod_name,label_app) (
    label_replace(kube_pod_labels{label_app!=""},"pod_name","$1","pod","(.*)")
  )
)</code></pre>
      </div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/mem_per_app-0f0a37acb794c49740014ce150e3ae1f-0a8a9.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 79.38144329896907%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACRElEQVQ4y5VTW24TQRDcg/jLf/6whOADJ1Yi28hPya/4Br4HCgQQQoJTBCkovgC5gi9BHNsB4pAEvLszs48punv9iKMEhZFqe2Z7pra6ptex1iIMQyilJGqt4fs+XNfFfD6HMWaVZ/Ca857ngc/ehcOPwASCOI4RRZGASYIgkDm/5zVjmQuDZH9sYyGSOcHhF9pX0J7CclhKwGI97O3FeghJRB/TAYzSiMIIzkqNNtCuokhJT8P4Wg7YW8x8OKZDgTIbiLmKaKlwIZUPhmZZYgR/7opqJg/IN+35Ugkr4XLDhR08oihcYKFQa9rIMKTMKIFSHnzPxfXPGZTvCZI8fSAg0jCQPXxOa1/AlTpsPN+cfcAji/v9W9trN/Ynt8ztQGoMtUISk3nA0EbyEZtO8wTkL4M7Q0DvaA976djY4ub3DS5+zTC7usSlYIaLK17PqN/m+ONeY/JjjPH5GJPvU4oTjM5H+DY5xel0hLPpGUYUPeXDYanD4RCHnw8xGAwEx6t4jKMvRzg5+brwlbxij8lDbbTMZW2SdUSXKYSv9l/i2dMnKBZL2N3dFRQKBeRyOaTTadRqNWmLxwwhfP3mHfL5HbRaTdTrdTQaDUGxWEQmk0Gn01m1yH2/28avx5vevj9AfmdLSCqVCqrVqqhihalUCu12+z8JD4hwe1sImWxJuiy52WxKS9xtkwdL3ifC51ukkMplMlZXKpWEMJvNotvtStM+mvDTxw94USpgb68nfjFarRZ6vR7K5TL6/f5Gyf8afwEmkHH4kHQEfAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="mem_per_app"
        title=""
        src="/static/mem_per_app-0f0a37acb794c49740014ce150e3ae1f-fb8a0.png"
        srcset="/static/mem_per_app-0f0a37acb794c49740014ce150e3ae1f-1a291.png 148w,
/static/mem_per_app-0f0a37acb794c49740014ce150e3ae1f-2bc4a.png 295w,
/static/mem_per_app-0f0a37acb794c49740014ce150e3ae1f-fb8a0.png 590w,
/static/mem_per_app-0f0a37acb794c49740014ce150e3ae1f-526de.png 885w,
/static/mem_per_app-0f0a37acb794c49740014ce150e3ae1f-0a8a9.png 970w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
<h2>CPU and IO usage per label</h2>
<p>Now that we know how to join the <code>kube_pod_labels</code> metric with cadvisor metrics,
we can figure out usage of other resources too.</p>
<h3>CPU</h3>
<div class="gatsby-highlight">
      <pre class="language-none"><code>sum by (label_app,namespace) (
  rate(container_cpu_usage_seconds_total[2m]) * on (pod_name) group_left(label_app)
  max by (pod_name,label_app) (
    label_replace(kube_pod_labels{label_app!=""},"pod_name","$1","pod","(.*)")
  )
)</code></pre>
      </div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/cpu_per_app-ee8bde4b930678ada8505a9cc8e749ba-0a8a9.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 79.38144329896907%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACR0lEQVQ4y5WTzW4SURTHeZCu2LEgUTfSEkAwUCDhq7wB72Eaq8aY6FvYpCZ04cpAxYWbmhJakKqgViENlE7LlzPADF9/7zkwLSWEtDf555577p3fPeeeM4bxeIzBYIBut8uzqqpsK4oCWZahaRr7e70ei9a03+l0QN/OyzAcDq8+IptmUr/fZ5Fv1q/btDcajXg9Oxv0AzTohmVjfl+PamITdHANXBT+vCiCRX4a/b7KYiCFfxugHuAi4L/2mXjXxvIIaWhaR6Si8VpTFVGQhjivTf19UUSZdVbNQ5Evbr6hqnY5Lf1NJkBF3FwXoBYkqYha7VhUXxIVbwm10WyUcXHxE+XSvjjXnACVtgylJUOqVtC6rPNaqlTQlOoon2RQ+JbCaekQvwop/C5+Qulkf6ovPBe/7+HH8Qd0CUipyO0GGlIVdamCy/Myzmt/2a5Lpyj9SaNQ+Iz81xQymQSyR0nksgmk0++RO0ogn0sie0j+jyJlAaS0DtIH2N5+i93dOCsej1/ZOzvvkEjuceFUlXqT+lE803Ak5tHEnor7kICbm0/w4P49OJ1O2O122Gx2OBwOWCwWGI1GeL1ebtybvTjbk9c2A58+ewGr1YZgMACfzwe/38+iC0wmE8Lh8A3gMjHw+cstWG2rDPF4PFhfX+eoKMKVlRWEQqE7ArcEcG2NgQTToXrKgUBgpp2W/56TNxTAh6siQpEuwSg6l8vFQLPZjEgkcuv/nYFvXr/CY9cjbGxE+b1IwWAQ0WgUbrcbsVhsQVEWj//2cGesm4V6ogAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="cpu_per_app"
        title=""
        src="/static/cpu_per_app-ee8bde4b930678ada8505a9cc8e749ba-fb8a0.png"
        srcset="/static/cpu_per_app-ee8bde4b930678ada8505a9cc8e749ba-1a291.png 148w,
/static/cpu_per_app-ee8bde4b930678ada8505a9cc8e749ba-2bc4a.png 295w,
/static/cpu_per_app-ee8bde4b930678ada8505a9cc8e749ba-fb8a0.png 590w,
/static/cpu_per_app-ee8bde4b930678ada8505a9cc8e749ba-526de.png 885w,
/static/cpu_per_app-ee8bde4b930678ada8505a9cc8e749ba-0a8a9.png 970w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
<h3>Disk IO</h3>
<p>I wanted to show you some disk IO stats too. Unfortunately these are
<a href="https://github.com/kubernetes/kubernetes/issues/55397">broken</a> once
<a href="https://github.com/kubernetes/kubernetes/issues/55398">again</a> in Kubernetes.</p>
<h3>Network</h3>
<div class="gatsby-highlight">
      <pre class="language-none"><code>sum by (label_app,namespace) (
  rate(container_network_transmit_bytes_total[2m]) * on (pod_name) group_left(label_app)
  max by (pod_name,label_app) (
    label_replace(kube_pod_labels{label_app!=""},"pod_name","$1","pod","(.*)")
  )
)</code></pre>
      </div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/net_per_app-9cdc5336080b286047c358a645a9a8ed-0a8a9.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 79.38144329896907%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACEElEQVQ4y5VTS24aQRCdg7BixwIp8ibYyOCZiG/EAOYG3CNCdhJFkZJbIDbmAJyBcySb2HyGAYb59XNVDT0GTCKnpZqu7q5+9epVjxHHMYIgwHa7RRiG2O124q/Xa7iuC9/3Zd/zPDFe8/lms4FS6pUZHKwvRVEkMyfQdrh/GsNkeH04G/xh00PFdEBM/ncwOwFkZM4mlOkgZmauI76iAJ4jb4uY4s6VqE0TMzRd3oQGXC33WRPm4cpBTGVKkj0bnUzfO2LImpwF3EsROEsCDKD25bEfbtwU6AhQN0WXHAW+AOCg5MBZSKI0xk9iUlkOS+aF7lDMPgX7SwKg6CiM5JK/mENF4UsHuOMkw+lINQw5O11QrCX5EZXDmjErVo0TLJ8esZg9wSHwxeMfzH//Et+Zz2ieYUUx3FyDkafTKYbDIcYPDxiPtY1lHo1GmEwmIotH3eaHz37yTv3EuCqymJ6cAA4Gn3Bx8Q6maaFUKomVy2UUCgVks1nU63WSJX7TexTAu89fUSxew7ZbaDQa+NhsoklmmiZyuRw6nY7o/NJVxc7p005+PXa/fLtH8fpSQKrVKmq1mrBihplMBu12+wjwX5YA3hPg1ZUAMpgG1SW3Wq3091SvmJ0peUCA7y+JIZXLYMzOsiwBzOfz6Ha78vjfDPjzx3d8sG5we9sTvdhs20av10OlUkG/3z/R8O/jGTNndueoXiN5AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="net_per_app"
        title=""
        src="/static/net_per_app-9cdc5336080b286047c358a645a9a8ed-fb8a0.png"
        srcset="/static/net_per_app-9cdc5336080b286047c358a645a9a8ed-1a291.png 148w,
/static/net_per_app-9cdc5336080b286047c358a645a9a8ed-2bc4a.png 295w,
/static/net_per_app-9cdc5336080b286047c358a645a9a8ed-fb8a0.png 590w,
/static/net_per_app-9cdc5336080b286047c358a645a9a8ed-526de.png 885w,
/static/net_per_app-9cdc5336080b286047c358a645a9a8ed-0a8a9.png 970w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p></div><hr style="margin-bottom:1.75rem;" data-reactid="9"/><div style="display:flex;margin-bottom:4.375rem;" data-reactid="10"><img src="/static/profile-pic.c22be3bb.jpg" alt="Johannes Ziemke" style="margin-right:0.875rem;margin-bottom:0;width:3.5rem;height:3.5rem;" data-reactid="11"/><p data-reactid="12"><!-- react-text: 13 -->By <!-- /react-text --><strong data-reactid="14">Johannes Ziemke</strong><!-- react-text: 15 -->.<!-- /react-text --><!-- react-text: 16 --> <!-- /react-text --><br data-reactid="17"/><!-- react-text: 18 -->You can <!-- /react-text --><strong data-reactid="19"><a href="/hire-me" data-reactid="20">hire me</a></strong><!-- react-text: 21 -->.<!-- /react-text --></p><span style="margin-left:auto;" data-reactid="22"><a href="https://twitter.com/discordianfish" data-reactid="23"><i class="icon-twitter" data-reactid="24"></i></a><a href="https://github.com/discordianfish" data-reactid="25"><i class="icon-github-circled" data-reactid="26"></i></a></span></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0;" data-reactid="27"><li data-reactid="28"><a rel="prev" href="/2017/04/17/selenium-webdriver-chromedriver-nightwatch-chrome-headless/" data-reactid="29"><!-- react-text: 30 -->← <!-- /react-text --><!-- react-text: 31 -->Frontend Testing Zoo - Or, Nightwatch without Selenium<!-- /react-text --></a></li><li data-reactid="32"><a rel="next" href="/2017/12/15/production-grade-kubernetes/" data-reactid="33"><!-- react-text: 34 -->Production Grade Kubernetes<!-- /react-text --><!-- react-text: 35 --> →<!-- /react-text --></a></li></ul></div><span style="display:block;clear:both;" data-reactid="36"> </span></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-c50d81e93841ea8bc545.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","107818501498521":"component---src-templates-blog-post-js-4fda7d55e9794dbb1ab9.js","35783957827783":"component---src-pages-index-js-c2006062114a52fe6167.js","60335399758886":"path----1ffe6c03441b7b427cb3.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","176796638445973":"path---2018-02-17-found-severe-azure-kubernetes-bug-and-aint-even-got-a-lousy-t-shirt-39b40b402c3f864f47c4.js","99864164588419":"path---2018-02-01-kubecfn-cloudformation-installer-for-reasonably-secure-multi-master-kubernetes-cluster-ca3a6fb464cea7838cb3.js","214880966025118":"path---2017-12-15-production-grade-kubernetes-39e40abbf3ecbebe7f14.js","263596615691880":"path---2017-11-09-use-prometheus-vector-matching-to-get-kubernetes-utilization-across-any-pod-label-0f18eef791eb11be0317.js","33143188725548":"path---2017-04-17-selenium-webdriver-chromedriver-nightwatch-chrome-headless-a9b0c003849a2557274b.js","162183589928130":"path---2016-11-20-15-producation-grade-kubernetes-cluster-6319187cb9c0cf85f99f.js","41627737030171":"path---2015-10-05-the-future-fabrication-cloud-81473bd20e2f1d1773b6.js","74228480928951":"path---2015-10-02-the-future-29d28089d2717a48ccb8.js","229428869920157":"path---2015-09-02-uploaded-thousands-of-photos-to-google-photos-here-are-the-best-classification-mistakes-3f09d0f8f558057f9b72.js","173914803063736":"path---2015-08-31-dont-manage-config-unless-you-have-to-2525053a200d2ee9c1a0.js","21869895544540":"path---2015-04-27-cloudformation-driven-consul-in-autoscalinggroup-a35da88219280ea1fe59.js","23322709388340":"path---2015-04-22-scope-and-ownership-in-tech-companies-286943ec3c086fa7b1e8.js","200459074764225":"path---2015-03-13-building-aws-amis-from-scratch-574a2c21554b108346a8.js","266226263243380":"path---2015-02-10-prometheus-on-raspberry-pi-da1e967aa644f27497c9.js","114328391656268":"path---2015-01-27-find-ghosts-in-your-docker-images-0545e7f7dfe1ee32bc3e.js","119570531827300":"path---2015-01-26-monitor-docker-containers-with-prometheus-f43a52b00725ccc4bc29.js","7844381199199":"path---2015-01-08-containerized-infrastructure-f3d5a0ba9797f72dde99.js","48650439439500":"path---2014-11-13-using-docker-run-netcontainerxx-to-debug-network-issues-c7c76d16a2cf09764a63.js","228256526782408":"path---2014-11-10-running-a-highly-available-load-balancer-on-docker-f4b88788c8f8ebf4aa9e.js","273472638405565":"path---hire-me-d231c7d0c108bb0d5d84.js","142629428675168":"path---index-75e24ff2af6dfeb3f773.js","114276838955818":"component---src-layouts-index-js-bb0078f6fed199dc13ad.js"}/*]]>*/</script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-03554c3de8e6350a1b07.js","/app-c50d81e93841ea8bc545.js","/path---2017-11-09-use-prometheus-vector-matching-to-get-kubernetes-utilization-across-any-pod-label-0f18eef791eb11be0317.js","/component---src-templates-blog-post-js-4fda7d55e9794dbb1ab9.js","/component---src-layouts-index-js-bb0078f6fed199dc13ad.js"])/*]]>*/</script></body></html>
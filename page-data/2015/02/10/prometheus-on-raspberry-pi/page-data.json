{"componentChunkName":"component---src-templates-blog-post-js","path":"/2015/02/10/prometheus-on-raspberry-pi/","result":{"data":{"site":{"siteMetadata":{"title":"5π Consulting","author":"Johannes 'fish' Ziemke"}},"markdownRemark":{"id":"4370d429-e2c3-563a-94ed-1ac5e17ffec9","html":"<h1 id=\"prometheus\" style=\"position:relative;\"><a href=\"#prometheus\" aria-label=\"prometheus permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prometheus</h1>\n<p><a href=\"http://prometheus.io\">Prometheus</a> is a new open-source service monitoring system and time series database written in Go.</p>\n<p>Check out the <a href=\"https://developers.soundcloud.com/blog/prometheus-monitoring-at-soundcloud\">announcement</a> and my article about <a href=\"/2015/01/26/monitor-docker-containers-with-prometheus\">monitoring Docker Containers with Prometheus</a> if you don’t know what I’m talking about.</p>\n<h1 id=\"my-stack\" style=\"position:relative;\"><a href=\"#my-stack\" aria-label=\"my stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>My Stack</h1>\n<p><img src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Raspberry_Pi_Photo.jpg/800px-Raspberry_Pi_Photo.jpg\" alt=\"RaspberryPi\">\nI stopped running my own full blown server(s) a while ago. Nowadays I just have a old Raspberry Pi at home and two tiny DigitalOcean instances to host this blog and for general R&#x26;D stuff.</p>\n<p>But I still want to monitor all this and, as showed earlier, Prometheus is the way to go. So I could now spin up another DigitalOcean instance and pay another $5/Mo, but given how cheap I am, I’d rather want to run it on my Raspberry Pi.</p>\n<h1 id=\"cross-compiling-go\" style=\"position:relative;\"><a href=\"#cross-compiling-go\" aria-label=\"cross compiling go permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cross-Compiling Go</h1>\n<p>First you need to build Go with support for your target OS and architecture. If you installed Go from sources, you can do this by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd $GOROOT/src\nGOARCH=arm ./make.bash</code></pre></div>\n<p>With pure Go, cross compilation is trivial. This example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">package main\n\nimport \"fmt\"\n\nfunc main() {\n\tfmt.Println(\"Hello World\")\n}</code></pre></div>\n<p>can be cross-compiling for arm with <code class=\"language-text\">GOARCH=arm go build test.go</code>.</p>\n<p>Now things get much more complicated once you use CGO, meaning Go code calling C functions.</p>\n<p>The Prometheus server uses the <a href=\"https://github.com/prometheus/client_golang\">Prometheus Go Client Library</a> to provide metrics about itself. This client library uses <a href=\"https://github.com/prometheus/procfs\">prometheus/procfs</a> which requires CGO to get process metrics from procfs. Cross-compiling this for Raspberry Pi is a pain. ARM != ARM, there are several variants and when I tried to cross-compiling Prometheus with CGO, it just lead to segfaults or invalid instructions. It should be possible to cross-compile it with the CGO dependency, it’s just painful and I quickly gave up.</p>\n<p>Fortunately, we found an easy way to remove the dependency on procfs if CGO is disabled: <a href=\"https://github.com/prometheus/client_golang/commit/93d11c8e35ffcd969fd881efe1873e715a6ef93b\">https://github.com/prometheus/client_golang/commit/93d11c8e35ffcd969fd881efe1873e715a6ef93b</a>. This removes some useful process level metrics about prometheus itself, but it makes cross compiling prometheus is as easy as in the example above:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd $GOPATH/src/github.com/prometheus/prometheus\ngo get -u # Update your dependencies\nGOARCH=arm go build -o prometheus.arm</code></pre></div>\n<p>Since cross-compilation by default disables CGO, this builds a statically linked prometheus binary ready to be run on a Raspberry Pi. If you’re running a newer Pi, you can set GOARM to the version of your ARM processor. See <a href=\"https://code.google.com/p/go-wiki/wiki/GoArm#Supported_architectures\">this</a> for supported architectures.</p>\n<h1 id=\"performance\" style=\"position:relative;\"><a href=\"#performance\" aria-label=\"performance permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Performance</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0c0309899e4000452ea789b5324129b0/e088a/rpi_gorouting.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.16564417177914%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDElEQVR42nVS7W4SQRTddzJGEw20CjbhHfhXIyLP0B++iI9g/CVpTGqqqVaKYovaCgS20EWWhd3Zj/meWe/MaqzWnkyyM3fvPXPOnes82Nqq1WrVarVSuV+gUqls3tssl8qXsbFRvnn77o1bd4pjqWR+O1ma+r6/Wq0ppUIIqf4DIWWe5887589eD/NLcKSUWZZijDnnkJdfD61zbTeQFiMEJQ5cSCgnXNnf1+IvFqUIIVwIB2ioBWgmBGMTlVJrWASijIEiSE2S5CqXkQ1FihIpuAKCLOMoNCtBkmKexBBkKJSMSUpMA7SGIAvXuihORmd0NmHrQCSIzFyZJgr8U6qlYIEvCY6/9Ig3FXGU26ZADhxNMXBFJ924/wlPJ3gyTM762va20MaBMQrDowPU6+DzsUChYiwdnmbu6Jds7E2xO0onA/S5k42/66Jz9hIoTk7768P94M1ufNxNB9/IhQs5eOZCirlZwVVF9pUOg+bo4/v1uz1/90XYPUAn3dXbV9lkgC9csGaKoU2WoZiIP2NiCKVAx0erw33U+wC6QHCw9zIdfGWrpSqeqpiNfx4zt0cop/MZmY5ZsCDWHfRc4gycG9ngOVguFwv/hwWM6sKsxXw+Nx8Izaae56VxnCvJ48hqNOrApgMz8HRn5+H2drP55LFF06LReAT7RqPRarXq9Xq73QYhvw3KwtRPpsfjmKEO+PoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"goroutines\"\n        title=\"\"\n        src=\"/static/0c0309899e4000452ea789b5324129b0/a6d36/rpi_gorouting.png\"\n        srcset=\"/static/0c0309899e4000452ea789b5324129b0/222b7/rpi_gorouting.png 163w,\n/static/0c0309899e4000452ea789b5324129b0/ff46a/rpi_gorouting.png 325w,\n/static/0c0309899e4000452ea789b5324129b0/a6d36/rpi_gorouting.png 650w,\n/static/0c0309899e4000452ea789b5324129b0/e548f/rpi_gorouting.png 975w,\n/static/0c0309899e4000452ea789b5324129b0/e088a/rpi_gorouting.png 1015w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\nI didn’t have time to benchmark it yet, but it seems to perform much better than I expected. Right now, it only scrapes itself, giving us ~250 time series. After running it for a few hours it already collected 137806 samples. Graphing a simple time series like <code class=\"language-text\">process_goroutines</code> for the past hour takes between 150-170ms. The probably most expensive operation you can do (and definitely shouldn’t do on a production system) is graphing <em>all</em> time series by executing <code class=\"language-text\">{job=~\".*\"}</code> this returns in about 30s on the Raspberry Pi.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/41ee3e1033ec4be8cbd8b134b87fc946/46e51/rpi_all-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.25766871165644%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABu0lEQVR42o2R20sCQRTG988KgqCIAhNL8bF/oAsUJUllBdFFKyhCuhLFotBDKiVEakFR5FNQDyFdntJMyrXWdB1nZ3Y7s26lXagfCwPfznfO+c5wZovFarWaWxjNzfAxTCaTwdBUjtHYVF3bUFVTbwR0xcgVESoUCoQQSqmiKOpPlNTdi5T3NF6uc5SQfD4vSRJCCPzqP0DFopDJgIV1llBRwnpb5TuqgmWalTCh7IJMZIzZuNCJg7+ITY5kWYb5oR7GmGgUNBSCY4nnpchVQsiVqpeCwMnJGvQvoBZ4xJw4H1gY2hj27HtYZn2095L6hio393EnKSQtQ+aG3sbRjTFtYRoVGVX1iwJQLXA8lW5pW6xrddung6BxpXj/NN8/PPY4JmyOkbHp8XTm8dexP20KJZTAkkGPnkeXV9o9fLeHtwlCUl8YKQO6qJUPrnVmCzs+2fH7OsOh/kjIIYoPP3eGGIiQHJJeXsWn53Qilbi5uz0+Ow3suPZDtvBe30FkMJtNMXPs+vIkenhwtLcb9vuD3s2tNd7rXl2fWViZmHMPu2bt41PdzqmuSWcHz/cEtwcCPntw2xGP37wBFp+hS+g2NuEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"goroutines\"\n        title=\"\"\n        src=\"/static/41ee3e1033ec4be8cbd8b134b87fc946/a6d36/rpi_all-1.png\"\n        srcset=\"/static/41ee3e1033ec4be8cbd8b134b87fc946/222b7/rpi_all-1.png 163w,\n/static/41ee3e1033ec4be8cbd8b134b87fc946/ff46a/rpi_all-1.png 325w,\n/static/41ee3e1033ec4be8cbd8b134b87fc946/a6d36/rpi_all-1.png 650w,\n/static/41ee3e1033ec4be8cbd8b134b87fc946/e548f/rpi_all-1.png 975w,\n/static/41ee3e1033ec4be8cbd8b134b87fc946/46e51/rpi_all-1.png 1003w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"downloads\" style=\"position:relative;\"><a href=\"#downloads\" aria-label=\"downloads permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Downloads</h1>\n<p><strong>Update:</strong> There are now official images available:\n<a href=\"https://prometheus.io/download/\">https://prometheus.io/download/</a></p>\n<h3 id=\"checksums\" style=\"position:relative;\"><a href=\"#checksums\" aria-label=\"checksums permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Checksums</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ shasum prometheus.armv?.gz\ndb42a3f568bbab1d8a7d183b336d0b50dccc80b6  prometheus.armv5.gz\nb6fdd3a77e16359631a0daaf9c06cd93a9948932  prometheus.armv6.gz\n8d3e6580ee4ed3d10b93d60c13009156a5600193  prometheus.armv7.gz\n\n$  sha256sum prometheus.armv?.gz\ne206202bb07cc139eaabac4c51c07f0a332337eb331bd79f19294c558fb3de62  prometheus.armv5.gz\n99d864e4fee8ded6b0f9c117f839fdf0fa9d12fadfe27b98090bee04b88c48c0  prometheus.armv6.gz\nbaf550448174198c57f3a28e2b86d49ba523e5b15d9d4c087267021e4785299b  prometheus.armv7.gz</code></pre></div>","frontmatter":{"title":"Prometheus on Raspberry Pi","date":"February 10, 2015","image":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAACpElEQVR42o1TW08TQRTeP4FKAzHx7/BghQf/gbz67A/woQHa6pPRWiUmvsiLicREUVCQArakXMK1tlDb0u1eZm8zszOzW8/uQMEK6tdmcubs+eY7c84ZZQgwHC2JRGJgYODaFbg5NHhrODF44/rFCOXFGfL5/PPLAN6nz3L3HqTu3n84+fjJq+mX+XwUDBSl+1eEYbQyEbxeaT2aO652MGwD6e12FfF/CMMAWEFwukXI1DT9H8p9KZxJdm3bNk0zUoYDwwuQHumUWn0BElHajuMQQrgQvb/reZgQWBljYGiaBgGxbA+nZykQzgjxbcSw67s2J5gRzCkVnIMi2GBwzoTvy3TAKThjngssxddUX+/4uspMHQxuW9yxmKn5WhuSdn/sMRsFnHEbReIBlK1LTxqkWfeRqTg75YDgXlayHuAhjWO4vVkq2Fvr8XF6j0zqVVKvRWSrvCYwlh+ibzFfEIyPKkA21hY7n2fxzxqocc8VPhWQcu3Q2d3wLaQYK1/En8rMtzeL4De/L7VnZ9y9LWuzyJBBm3WqtnC96u5vU0NT4EiBvUvIO2VIylhZOJl9oy99QqUCrtdQcdk53KHtJvCJ2lLOGx/zz8hRbmbxm7E8r35425l7h0rLkKq++LEz/x5q7FUPSLuphPEA9CnDxjuqGKuLemHB2ijCtdF6wdndROW1xsw0lAAfV6O0f5/B8yGEVkGdge9W9iALsOEW3DKN1a9e7QBaBRNx/jB4DGnBOyCaitWWXdkn6gmUijSO7O316EaCh4EIY8qVyoHnhozJFsKQQDRtt4DZG/uInMmkMzGymczExMTk1FQ2m02n05l0GoxUKpXL5eQL4ZTIF0kplUcoyWRydHR0bGwM1jtJ+EVIJm+DH5wjIyPj4+N9vehtfwHAUwvA4ATlAwAAAABJRU5ErkJggg==","width":1015,"height":1015,"src":"/static/0c0309899e4000452ea789b5324129b0/c9f7c/rpi_gorouting.png","srcSet":"/static/0c0309899e4000452ea789b5324129b0/c9f7c/rpi_gorouting.png 1x"}}}}}},"pageContext":{"slug":"/2015/02/10/prometheus-on-raspberry-pi/","previous":{"fields":{"slug":"/2015/01/27/find-ghosts-in-your-docker-images/"},"frontmatter":{"title":"Find GHOSTs in your Docker images"}},"next":{"fields":{"slug":"/2015/03/13/building-aws-amis-from-scratch/"},"frontmatter":{"title":"Building AWS AMIs from Scratch for Immutable Infrastructures"}}}},"staticQueryHashes":[],"slicesMap":{}}
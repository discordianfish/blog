{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017/11/09/use-prometheus-vector-matching-to-get-kubernetes-utilization-across-any-pod-label/","result":{"data":{"site":{"siteMetadata":{"title":"5π Consulting","author":"Johannes 'fish' Ziemke"}},"markdownRemark":{"id":"21b75828-4319-5f03-b011-11a7bff52344","html":"<p>Prometheus was designed for dynamic environments like Kubernetes. Its powerful\nservice discovery and query language allows you to answer all kind of questions\nthat come up while operating a Kubernetes cluster.</p>\n<p>This flexibility comes with a somewhat steeper learning curve than some\nalternatives and hosted services, with <a href=\"https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching\">Vector\nMatching</a>\nbeing one of the more advanced topics.</p>\n<p>I’m not going into the details which the excellent <a href=\"https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching\">Prometheus\nDocumentation</a>\nhas already covered but walk you through some useful queries to get resource\nutilization in a Kubernetes cluster.</p>\n<h2 id=\"aggregated-memory-usage-per-label\" style=\"position:relative;\"><a href=\"#aggregated-memory-usage-per-label\" aria-label=\"aggregated memory usage per label permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Aggregated memory usage per label</h2>\n<p>Kubernetes provides a <code class=\"language-text\">container_memory_usage_bytes</code> metric reflecting each pods\nmemory usage, e.g:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">...\ncontainer_memory_usage_bytes{beta_kubernetes_io_arch=\"amd64\",beta_kubernetes_io_fluentd_ds_ready=\"true\",beta_kubernetes_io_instance_type=\"g1-small\",beta_kubernetes_io_os=\"linux\",cloud_google_com_gke_nodepool=\"small-preemptible\",cloud_google_com_gke_preemptible=\"true\",container_name=\"POD\",failure_domain_beta_kubernetes_io_region=\"us-east1\",failure_domain_beta_kubernetes_io_zone=\"us-east1-c\",id=\"/kubepods/burstable/pod13d4221c-c484-11e7-bff5-42010af0018b/67e5bb069ab9881ff8a55b8628ef4935b0d1ace09c18df20db059522bdfd5b7d\",image=\"gcr.io/google_containers/pause-amd64:3.0\",instance=\"gke-latency-at-small-preemptible-0c981b61-9489\",job=\"kubernetes-cadvisor\",kubernetes_io_hostname=\"gke-latency-at-small-preemptible-0c981b61-9489\",name=\"k8s_POD_latency-api-971504058-jzs5h_default_13d4221c-c484-11e7-bff5-42010af0018b_0\",namespace=\"default\",pod_name=\"latency-api-971504058-jzs5h\"}\t389120\ncontainer_memory_usage_bytes{beta_kubernetes_io_arch=\"amd64\",beta_kubernetes_io_fluentd_ds_ready=\"true\",beta_kubernetes_io_instance_type=\"g1-small\",beta_kubernetes_io_os=\"linux\",cloud_google_com_gke_nodepool=\"small-preemptible\",cloud_google_com_gke_preemptible=\"true\",container_name=\"POD\",failure_domain_beta_kubernetes_io_region=\"us-east1\",failure_domain_beta_kubernetes_io_zone=\"us-east1-c\",id=\"/kubepods/burstable/pod81d0f651-c500-11e7-bff5-42010af0018b/309e05b118e618122c70ccf88538d13ca41c3b5a770d5d67882426854391c23c\",image=\"gcr.io/google_containers/pause-amd64:3.0\",instance=\"gke-latency-at-small-preemptible-0c981b61-9489\",job=\"kubernetes-cadvisor\",kubernetes_io_hostname=\"gke-latency-at-small-preemptible-0c981b61-9489\",name=\"k8s_POD_latency-api-971504058-gszpw_default_81d0f651-c500-11e7-bff5-42010af0018b_0\",namespace=\"default\",pod_name=\"latency-api-971504058-gszpw\"}\t372736\ncontainer_memory_usage_bytes{beta_kubernetes_io_arch=\"amd64\",beta_kubernetes_io_fluentd_ds_ready=\"true\",beta_kubernetes_io_instance_type=\"g1-small\",beta_kubernetes_io_os=\"linux\",cloud_google_com_gke_nodepool=\"small-preemptible\",cloud_google_com_gke_preemptible=\"true\",container_name=\"latency-api\",failure_domain_beta_kubernetes_io_region=\"us-east1\",failure_domain_beta_kubernetes_io_zone=\"us-east1-c\",id=\"/kubepods/burstable/pod13d4221c-c484-11e7-bff5-42010af0018b/497e6fdf2217771cb3f52e6fef93734d023f0e7f23f92c58d22139fc18dc5f13\",image=\"registry.gitlab.com/latency.at/latencyat@sha256:8ea057e064b64cc9c8459a68ef3f6d0fc26169b4f57aef193831779e1fe713d4\",instance=\"gke-latency-at-small-preemptible-0c981b61-9489\",job=\"kubernetes-cadvisor\",kubernetes_io_hostname=\"gke-latency-at-small-preemptible-0c981b61-9489\",name=\"k8s_latency-api_latency-api-971504058-jzs5h_default_13d4221c-c484-11e7-bff5-42010af0018b_1\",namespace=\"default\",pod_name=\"latency-api-971504058-jzs5h\"}\t11014144\ncontainer_memory_usage_bytes{beta_kubernetes_io_arch=\"amd64\",beta_kubernetes_io_fluentd_ds_ready=\"true\",beta_kubernetes_io_instance_type=\"g1-small\",beta_kubernetes_io_os=\"linux\",cloud_google_com_gke_nodepool=\"small-preemptible\",cloud_google_com_gke_preemptible=\"true\",container_name=\"latency-api\",failure_domain_beta_kubernetes_io_region=\"us-east1\",failure_domain_beta_kubernetes_io_zone=\"us-east1-c\",id=\"/kubepods/burstable/pod81d0f651-c500-11e7-bff5-42010af0018b/7b438a8e9df0cf1ab29d067fd36c97099f9f5e7e9257f6187c5be6bff846a62c\",image=\"registry.gitlab.com/latency.at/latencyat@sha256:8ea057e064b64cc9c8459a68ef3f6d0fc26169b4f57aef193831779e1fe713d4\",instance=\"gke-latency-at-small-preemptible-0c981b61-9489\",job=\"kubernetes-cadvisor\",kubernetes_io_hostname=\"gke-latency-at-small-preemptible-0c981b61-9489\",name=\"k8s_latency-api_latency-api-971504058-gszpw_default_81d0f651-c500-11e7-bff5-42010af0018b_0\",namespace=\"default\",pod_name=\"latency-api-971504058-gszpw\"}\t11448320\n...</code></pre></div>\n<p>Unfortunately it doesn’t contain the pod labels. For that there is the\n<code class=\"language-text\">kube_pod_labels</code> though which includes a static timeseries with all labels and\nthe pod name. This metric is provided by\n<a href=\"https://github.com/kubernetes/kube-state-metrics\">kube-state-metrics</a>.</p>\n<p>We can use it to look up the labels for the pod from the\ntimeseries (<code class=\"language-text\">pod_name=\"latency-api-971504058-jzs5h\"</code>):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kube_pod_labels{instance=\"10.116.0.12:8080\",job=\"kubernetes-service-endpoints\",k8s_app=\"kube-state-metrics\",kubernetes_name=\"kube-state-metrics\",kubernetes_namespace=\"kube-system\",label_app=\"latency-api\",label_pod_template_hash=\"971504058\",namespace=\"default\",pod=\"latency-api-971504058-jzs5h\"} 1\nkube_pod_labels{instance=\"10.116.1.26:8080\",job=\"kubernetes-service-endpoints\",k8s_app=\"kube-state-metrics\",kubernetes_name=\"kube-state-metrics\",kubernetes_namespace=\"kube-system\",label_app=\"latency-api\",label_pod_template_hash=\"971504058\",namespace=\"default\",pod=\"latency-api-971504058-jzs5h\"} 1</code></pre></div>\n<p>Both metrics can be merged by using vector matching. We get this metric twice\nbecause there are two instances of kube-state-metrics running. So before we\ncontinue further, we aggregate both. Since they should be identical, we can use\nmin/max to aggregate. Since we later want to aggregate on <code class=\"language-text\">label_app</code>, we need\nto keep that label. We also need to keep the <code class=\"language-text\">pod</code> label to join both metrics\non. We can preserve them by specifying them in the BY clause. Since the pod\nlabel is called <code class=\"language-text\">pod</code> in <code class=\"language-text\">kube_pod_labels</code> but <code class=\"language-text\">pod_name</code> in\n<code class=\"language-text\">container_memory_usage_bytes</code>, we need to also use label_replace to rename the\nlabel. This gives us:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">max by (pod_name,label_app) (\n  label_replace(kube_pod_labels{label_app!=\"\"},\"pod_name\",\"$1\",\"pod\",\"(.*)\")\n)</code></pre></div>\n<p>Which returns something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">...\n{label_app=\"latency-api\",pod_name=\"latency-api-971504058-n8k6d\"}  1\n{label_app=\"latency-api\",pod_name=\"latency-api-971504058-jzs5h\"}  1\n...</code></pre></div>\n<p>Now we can use vector matching to join <code class=\"language-text\">container_memory_usage_bytes</code> with the\nresult of our expression. We use the <code class=\"language-text\">*</code> operator which effectivly is a no-op\nsince it will multiply the memory usage by the matched timeseries value in\n<code class=\"language-text\">kube_pod_labels</code> which is always 1.</p>\n<p>We need to specify <code class=\"language-text\">group_left</code> because there are multiple\n<code class=\"language-text\">container_memory_usage_bytes</code> timeseries for each pod, one for each container.\nSince we want to preserve the <code class=\"language-text\">label_app</code> label, we specify it as argument to <code class=\"language-text\">group_left</code>.</p>\n<p>This gives us:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  container_memory_usage_bytes * on (pod_name) group_left(label_app)\n  max by (pod_name,label_app) (\n    label_replace(kube_pod_labels{label_app!=\"\"},\"pod_name\",\"$1\",\"pod\",\"(.*)\")\n  )</code></pre></div>\n<p>To aggregated the memory usage of all your pods, summed by a <code class=\"language-text\">k8s-app</code> label you\ncan use the following expression:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sum by (label_app,namespace) (\n  container_memory_usage_bytes * on (pod_name) group_left(label_app)\n  max by (pod_name,label_app) (\n    label_replace(kube_pod_labels{label_app!=\"\"},\"pod_name\",\"$1\",\"pod\",\"(.*)\")\n  )\n)</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f0a37acb794c49740014ce150e3ae1f/587b0/mem_per_app.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.14110429447852%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACRUlEQVQ4y5VUyW4aQRCdH+FEThxQ5EsYkrBJ7DayzJ2PiRBOlBz8E/HBETkn+Qf+AQzYVvAmM0t3z/JSVcMQO4ocUtJzd3VVv35VNdiK4xhBEMD3fVmVUvA8D67rYr1eQ2u9jTPYT+N8909Y/MdoQ9CIoghhGCIIAyExxojP5+wzJL6J8TmDOdK9FZGjPB/K8ZFaTIEnFuOvxnlRSI+RIO0rhEEIa/ui0kJqFAVdBe2p7eup8eWI8o2vt9AEJkpirHAjlY1fSkv01g6U6ws5nyvXk0pYSUDlBkZLLhuvYZi0wwrpslKUyNCkTCd733Pguw7urla0dwVJXFH/iDQwNCRXcpXvCbhSi5urKOlxadsSWX0cPdvKJy3hociU6RVDn4FmFbQaUmZozwg094oarhj0JfDXwCv5MbWCwWch5UQ8FCa8f7jHz5sVVrfXgutb2pPPZ46zxoNzh8XVHPOLORaXS8wvF5hdzDBdTDFdznC+PMdsMYNLAiyWOplM8Pn0FOOv4wTj3zj7cobvP75Rnz3pmdr0WlGvfe3Jqja+DIUJh8N32Nt7iVqthnKpjFKphEqlAtu2kc2+QL1ep0EE2MWEcDT6gGLxDXq9A7TbbXQ6HUG1WkUul8P+wb78MtIhPAchfP9xhOJbm0i6aDQaaDabaLVaojCTyaDb7f4n4fEIr21bVDFZSpqUnBXVjwn/WfJwdIxXBSKki0zG6rifhUIB+XyeWtGT/zI7E56cfCKCMo6O+jg8PBQwSb/fl4EMBoOdFf4CsVxyJpzLTv4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"mem_per_app\"\n        title=\"mem_per_app\"\n        src=\"/static/0f0a37acb794c49740014ce150e3ae1f/a6d36/mem_per_app.png\"\n        srcset=\"/static/0f0a37acb794c49740014ce150e3ae1f/222b7/mem_per_app.png 163w,\n/static/0f0a37acb794c49740014ce150e3ae1f/ff46a/mem_per_app.png 325w,\n/static/0f0a37acb794c49740014ce150e3ae1f/a6d36/mem_per_app.png 650w,\n/static/0f0a37acb794c49740014ce150e3ae1f/587b0/mem_per_app.png 970w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"cpu-and-io-usage-per-label\" style=\"position:relative;\"><a href=\"#cpu-and-io-usage-per-label\" aria-label=\"cpu and io usage per label permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CPU and IO usage per label</h2>\n<p>Now that we know how to join the <code class=\"language-text\">kube_pod_labels</code> metric with cadvisor metrics,\nwe can figure out usage of other resources too.</p>\n<h3 id=\"cpu\" style=\"position:relative;\"><a href=\"#cpu\" aria-label=\"cpu permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CPU</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sum by (label_app,namespace) (\n  rate(container_cpu_usage_seconds_total[2m]) * on (pod_name) group_left(label_app)\n  max by (pod_name,label_app) (\n    label_replace(kube_pod_labels{label_app!=\"\"},\"pod_name\",\"$1\",\"pod\",\"(.*)\")\n  )\n)</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee8bde4b930678ada8505a9cc8e749ba/587b0/cpu_per_app.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.14110429447852%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPklEQVQ4y5WSTW9SURCG+0dYsWPRqBu5VbGQAC1UQsq+/8XYUI0u+ivsosa6K9amcWclKaDW9COKXKuUj1JaLvdyv+B1ZihKG2zoSd7MnIHz3HfOmYlerwfHcWAYhkTTNCXXdR2apsGyLKl3Oh0R7zny73z2qiZc1/17iHOOLNu2RcN13g/n3W5X9sNxYvAHXvyF69bV3weuBrnrOv+Ao+xfFTsYVeflOCa5NvtAtj8OcGBwFLDVqtC9nl44/A+Ql23pcB1L9hblhtEkNxbVDWrRhmW2RZXjXXrE2uU7NE2D2nIvXHQlWrZOX27Qy56hXjtApcIHq7Q/FzWbKur1Q6jqB+jtRh/YbmnQzzTUy2WcnTSgn7dR47x+ip/FPPa/buGolMe3gy2RWtyG+n0bpeJHlCge7m1ib3edgNQyt6KdN9GolUm/cVJVUT3+gUb1F+mIDmSxv/ceXz5tYmcng3wug0I+g2z2DQq5dXwuvJVaPrcBrUVAbiuX28HKykusrb0e0prE1dVX2Nh4J7NqmhZdAc2nzKorsu1+zjWZQwYuPnmMO7dvIRgMIRAIiKanp6EoCrxeL8LhsEzCOLMqwHT6Gaam7iOReITZ2VnEYjFRMBiEz+fD3NzcJeB1EuDT52lMPVAIEkckEkE0GsXMzIw49Hg8iMfjNwQupXFPUcQVwwbQQcvs+kYtL6aXcNdPQDrIMHYXCoXg9/sxOTlJV5GQRxkbuLz8ggAPMT+fQjKZFDEklUrJgywsLIzt8A+RU2fWIfC1jwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cpu_per_app\"\n        title=\"cpu_per_app\"\n        src=\"/static/ee8bde4b930678ada8505a9cc8e749ba/a6d36/cpu_per_app.png\"\n        srcset=\"/static/ee8bde4b930678ada8505a9cc8e749ba/222b7/cpu_per_app.png 163w,\n/static/ee8bde4b930678ada8505a9cc8e749ba/ff46a/cpu_per_app.png 325w,\n/static/ee8bde4b930678ada8505a9cc8e749ba/a6d36/cpu_per_app.png 650w,\n/static/ee8bde4b930678ada8505a9cc8e749ba/587b0/cpu_per_app.png 970w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"disk-io\" style=\"position:relative;\"><a href=\"#disk-io\" aria-label=\"disk io permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disk IO</h3>\n<p>I wanted to show you some disk IO stats too. Unfortunately these are\n<a href=\"https://github.com/kubernetes/kubernetes/issues/55397\">broken</a> once\n<a href=\"https://github.com/kubernetes/kubernetes/issues/55398\">again</a> in Kubernetes.</p>\n<h3 id=\"network\" style=\"position:relative;\"><a href=\"#network\" aria-label=\"network permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Network</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sum by (label_app,namespace) (\n  rate(container_network_transmit_bytes_total[2m]) * on (pod_name) group_left(label_app)\n  max by (pod_name,label_app) (\n    label_replace(kube_pod_labels{label_app!=\"\"},\"pod_name\",\"$1\",\"pod\",\"(.*)\")\n  )\n)</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9cdc5336080b286047c358a645a9a8ed/587b0/net_per_app.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.14110429447852%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAklEQVQ4y5WTzXISQRSFeRFWsGJBqRsZNAhU8Z9QVNjzLpYpoqWLPIWpuMA1D2FewnJlwjD8zv/xnjv0mIlWxK469J2e7u+ee3vIRVEE3/ex2+0QBAFc19V4s9lgvV7rM9f3+73K8zx9v91uEcfxH8oZCOcwDHVmAoqHH68zNu8ZPxTN5UhlYEYscSRO/ncYTs5kVMvyIgok+8rRmHDO4X6HKAz+WqIRYQrkD6FchAE6y0PWxHkgCbgeH5yoDsnMuYxD9ucpIJ8jPwEmewIE23UKygAJY/PTktlwx86UTGDo/97DOLPnYcl8MDcUMRa4t1xILAeDUA959gKxJE4Hq5I2PB5pDwOWw6azl1JyuFlrWZHn0wM8cbO8+wn7/g7O0oYt8eLHdzi2DWdxj5UkXMk6LzdH8u3tN1xff8ZsNkv19TB/ubnBfD7Xb3Uvt+26ycfts2wvkee5KlaqwIt3b/Hi+TM0mk3UajVVvV6HZVkoFototVqa/ZihwOn0A6rV1xgOz9Dr9dDv91WNRgOlUglnp6cpUG/VCFnpX4+b3n+conpiCWSAdruNTqeDbrerDvP5PAaDQQb4lBLg5RSvLEtdEWagBBYKBXWdcfivki+ml3hZEaAcJIzumtLPSqWCcrksrRjqRRwNvLr6JIA3OD8fYzQaqQgZj8d6IZPJ5GiHvwBjwXcCQ/PQaQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"net_per_app\"\n        title=\"net_per_app\"\n        src=\"/static/9cdc5336080b286047c358a645a9a8ed/a6d36/net_per_app.png\"\n        srcset=\"/static/9cdc5336080b286047c358a645a9a8ed/222b7/net_per_app.png 163w,\n/static/9cdc5336080b286047c358a645a9a8ed/ff46a/net_per_app.png 325w,\n/static/9cdc5336080b286047c358a645a9a8ed/a6d36/net_per_app.png 650w,\n/static/9cdc5336080b286047c358a645a9a8ed/587b0/net_per_app.png 970w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"Use Prometheus Vector Matching to get Kubernetes Utilization across any Pod Label","date":"November 09, 2017","image":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC9UlEQVQ4y41US09aURDmj/iIC3dKExNEICWCGJ9x765JF01cqD/LCi7suq6NGmsk1ba2UcFaW6nAfZ774uvMXC4C1qY3+TJzZuZ8Zx7n3Fir1UIQBLBtW8C6ZVmiG4YBXdfRbDahlALHsmQ/+1zXlXWj0RCdvxgHeZ4nBpa+74v03NAWodvXbevfG2NW13Fg6yZ8Mv7r48MjKbqgNybGJboenahcIY02eA7ZbOcJiSAg9DEFnD3tEUKHMpQ+GhYszYRjKSGzSRdyKj8ijj7f8+FzWyhOGbZIVzlhD7n2zkkUyORB4ENZNizdgNIt2RD4gWwyNZ3sOiVg0lrRgQ710JU9QshNdRxFkzUFSlmdtWXpQvD75g6GpkGr16FsOoBIXFdJXKg7FGsgxmR8BdjBmQZB67FvBCG2+BC7r5/tmXS1git7UnJnmn096/Z1phzZum5AjAX3QekazKZGQ9HgmpQx9ciK1oYOnzL0Kc6nbF2TBmdwbw14fOHJF1AbPPLJPaxrDVzeVlD9+R3Vuxtc3VZx/aNKOsuKrO9r97h/+IXru2uxVcjPuKxc4uLqAl+q3/C58jUkrNVqKJ+e4vTkBOcfP+KsjfMzxlmofzoTNOoP0s9ms0FDMOWJWpQd6/wkhXD33S5y+SyWl5exsLDQxiIWFwlLS8jn88hkMhgbG8Px8YfwHtIV+tsnhMXtbUxOTKBQKCCXywkBy0ifmprC5GQCg4ODODg4aBP67cG10QpfT0hYKiGZfoklymZ+fl4wNzcnkrNNJBKIx+MYGhrC0dFRh7DnObYhhKWdIrKFDFZWVoSAS+Xy+QAmZrLR0VHJ8PDw8DHD50ouFYtIJRNCNjMzg9nZ2R6ZSqUwPj6OgYGBngyfJyztUFkpKZH7xr1kIpbpdFqGwYTDw8P/V/LW2y3EEy8wPT2NbDYrYJ2RTCZlKJzlyMgI9vf3O8/s2Qz39t7jzetX2NzcxPr6OjY2Njo6g/W1tTWsrq6iXC7LRr5z/Pvvxx9L+mZtS+outQAAAABJRU5ErkJggg==","width":970,"height":970,"src":"/static/0f0a37acb794c49740014ce150e3ae1f/0600f/mem_per_app.png","srcSet":"/static/0f0a37acb794c49740014ce150e3ae1f/0600f/mem_per_app.png 1x"}}}}}},"pageContext":{"slug":"/2017/11/09/use-prometheus-vector-matching-to-get-kubernetes-utilization-across-any-pod-label/","previous":{"fields":{"slug":"/2017/04/17/selenium-webdriver-chromedriver-nightwatch-chrome-headless/"},"frontmatter":{"title":"Frontend Testing Zoo - Or, Nightwatch without Selenium"}},"next":{"fields":{"slug":"/2017/12/15/production-grade-kubernetes/"},"frontmatter":{"title":"Production Grade Kubernetes"}}}},"staticQueryHashes":[]}
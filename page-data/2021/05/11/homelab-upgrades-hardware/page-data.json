{"componentChunkName":"component---src-templates-blog-post-js","path":"/2021/05/11/homelab-upgrades-hardware/","result":{"data":{"site":{"siteMetadata":{"title":"5π Consulting","author":"Johannes 'fish' Ziemke"}},"markdownRemark":{"id":"af7e2d51-776b-5df3-9f25-7b26c22f38a6","html":"<p><img src=\"/cf961ab6f525e753f89b5214b319e447/rack.svg\" alt=\"Diagram of Rack\">\n<strong>Disclaimer:</strong> <em>While writing this article, I realize I could use Affiliate\nLinks to the stuff I bought. So I gave it a try. Lemme know if that bothers\nyou</em>.</p>\n<p>I’ve been running <a href=\"/2019/05/10/k8s-on-openwrt/\">Kubernetes on\nOpenWrt</a> at home for two years now.\nAlthough I already believed that <a href=\"/2018/12/18/why-kubernetes-at-small-scale/\">Kubernetes makes sense at small\nscale</a> this was\nintended as experiment about how small it can be.</p>\n<p>What started as a silly experiment turned out to be totally worth it.\nThis has been to be the most reliable and convient to manage home (lab)\ninfrastructure I have been running.</p>\n<p>There were issues for sure, but putting my efforts into building a reliable\nKubernetes infrastructure that allows to cleanly deploy and remove applications\nat will was a great improvement over all a typial, manual and distribution\nspecific homelab setup that required me to “start over” quite frequently.</p>\n<p>Beside that, it’s also the ideal test bed to experiment with novel configuration\nand automation strategies as well as explore Kubernetes edge cases. If something\nworks under the constraints of a homelab setup, it will work for your cloud\nnative apps on the usual platforms as well.</p>\n<p style=\"text-align: right; margin-left: 10em; font-style: italic\">Of course we're not talking about scaling edge cases with 1k\nnode cluster sizes</p>\n<p>While running everything on my OpenWrt router served me well so far, I need more\ndisk space and want to run more applications. So I decided to double down on\nmy Kubernetes-At-Home setup and start a blog series about it.</p>\n<p>This is the first part talking about the hardware and storage setup.</p>\n<h2 id=\"hardware\" style=\"position:relative;\"><a href=\"#hardware\" aria-label=\"hardware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hardware</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.84662576687117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIFAwT/xAAUAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAGaz7hcBREf/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAIBAxQRMf/aAAgBAQABBQJHbnsQV1yZbWMlh//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAECAQE/AYf/xAAbEAACAQUAAAAAAAAAAAAAAAAAARAhMTJBof/aAAgBAQAGPwKaO5pmPT//xAAbEAACAgMBAAAAAAAAAAAAAAABIQBBEVFhkf/aAAgBAQABPyEjADxREo9IxHDT1KfniVUbMA6z/9oADAMBAAIAAwAAABCY3//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8QjmkZ/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPxCs8Kj/xAAdEAEBAAICAwEAAAAAAAAAAAABEQAhQWExUXHR/9oACAEBAAE/EGuoWBBD4ZoOGhY6yEZVEjEiBXlaesh8hxf1wRFW+uf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Photo of Rack\"\n        title=\"\"\n        src=\"/static/b65430bbc3db885e329c7095246c11f7/6aca1/rack.jpg\"\n        srcset=\"/static/b65430bbc3db885e329c7095246c11f7/d2f63/rack.jpg 163w,\n/static/b65430bbc3db885e329c7095246c11f7/c989d/rack.jpg 325w,\n/static/b65430bbc3db885e329c7095246c11f7/6aca1/rack.jpg 650w,\n/static/b65430bbc3db885e329c7095246c11f7/7c09c/rack.jpg 975w,\n/static/b65430bbc3db885e329c7095246c11f7/01ab0/rack.jpg 1300w,\n/static/b65430bbc3db885e329c7095246c11f7/d2602/rack.jpg 4032w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>While I’d love to have a full rack with real network gear and servers as much as\nthe next nerd, I’d find that extremly wasteful. Therefor my first goal is that\nthis setup should use as little power as possible.</p>\n<p>Secondly, I still live for rent in Berlin so a small physical footprint was\nanother consideration.</p>\n<div style=\"display: flex\">\n  <p style=\"width: 50%\">Therefor I went with this small(ish) 19\" Wall Mount Network Cabinate.\n  The maximum installation depth is just 32cm though, so a extra short server case\n  is needed. Unfortunately it doesn't seem to be available on US Amazon but there\n  are plenty of other options like <a href=\"https://amzn.to/3t3uzXe\">this</a>\n  </p>\n  <p>\n  <a href=\"https://www.amazon.de/Good-Connections%C2%AE-Wandgeh%C3%A4use-unmontiert-tiefschwarz/dp/B08FTH3ZBJ/ref=as_li_ss_il?crid=3CV1OP8QINXMK&amp;dchild=1&amp;keywords=good+connections+19%22+wandgeh%C3%A4use&amp;qid=1619774239&amp;sprefix=good+connections+19,aps,192&amp;sr=8-3&amp;th=1&amp;linkCode=li3&amp;tag=5pi-21&amp;linkId=3935e1373aedb1f800abbbe0bec6fe9e&amp;language=de_DE\" target=\"_blank\"><img border=\"0\" src=\"//ws-eu.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=B08FTH3ZBJ&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=DE&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=5pi-21&amp;language=de_DE\"></a><img src=\"https://ir-de.amazon-adsystem.com/e/ir?t=5pi-21&amp;language=de_DE&amp;l=li3&amp;o=3&amp;a=B08FTH3ZBJ\" width=\"1\" height=\"1\" border=\"0\" alt=\"\" style=\"border:none !important; margin:0px !important;\">\n  </p>\n</div>\n<div style=\"display: flex\">\n  <p style=\"width: 50%\">I found this server case which is just 25cm deep.\nThat case fits mini ITX boards only which is fine for a low power board.\nUnfortunately I can't find anything similar on US Amazon. This was also the\nhardest to find component. So if you have the space, just go with a bigger rack\nand case</p>\n  <p>\n  <a href=\"https://www.amazon.de/gp/product/B072F4CYKP/ref=as_li_ss_il?ie=UTF8&amp;linkCode=li3&amp;tag=5pi-21&amp;linkId=a4bb79f1379ca883ece0bdb284260ae2&amp;language=de_DE\" target=\"_blank\"><img border=\"0\" src=\"//ws-eu.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=B072F4CYKP&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=DE&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=5pi-21&amp;language=de_DE\"></a><img src=\"https://ir-de.amazon-adsystem.com/e/ir?t=5pi-21&amp;language=de_DE&amp;l=li3&amp;o=3&amp;a=B072F4CYKP\" width=\"1\" height=\"1\" border=\"0\" alt=\"\" style=\"border:none !important; margin:0px !important;\"></p>\n</div>\n<div style=\"display: flex\">\n  <p style=\"width: 50%\">I've decided to use the Super Micro A2SDi-2C-HLN4F-B\nhas Intel Atom C3338 onboard which should be sufficent and has a TDP of just 9W.\nIt supports 8 SATA3 ports which allows me to connect plenty of disks.\nand can power it directly from 12V,\nso bought a <a href=\"https://amzn.to/3gR28sU\">80W 12V MeanWell PSU</a> (<a href=\"https://amzn.to/2RafV3d\">DE</a>)\n  </p>\n  <p>\n  <a href=\"https://www.amazon.com/Supermicro-Motherboard-MBD-A2SDI-4C-HLN4F-B-Mini-ITX-Express/dp/B077BHMN8X?dchild=1&amp;keywords=A2SDi-2C-HLN4F-B&amp;qid=1619774725&amp;sr=8-1&amp;linkCode=li3&amp;tag=5pi-20&amp;linkId=59609640fb184ba633fe6353d29fea8e&amp;language=en_US&amp;ref_=as_li_ss_il\" target=\"_blank\"><img border=\"0\" src=\"//ws-na.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=B077BHMN8X&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=US&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=5pi-20&amp;language=en_US\"></a><img src=\"https://ir-na.amazon-adsystem.com/e/ir?t=5pi-20&amp;language=en_US&amp;l=li3&amp;o=1&amp;a=B077BHMN8X\" width=\"1\" height=\"1\" border=\"0\" alt=\"\" style=\"border:none !important; margin:0px !important;\">\n<br>(<a href=\"https://amzn.to/3nBPuzC\">DE</a>)\n  </p>\n</div>\n<div style=\"display: flex\">\n  <p style=\"width: 50%\">To house the disks I bought a ICY BOX 8x 2.5\" Backplane which fits the 2u 5.25\" drive\nbay, currently with 4x5TB disks and enough room for upgrades\n  </p>\n  <p>\n  <a href=\"https://www.amazon.de/gp/product/B082BR71DY/ref=as_li_ss_il?ie=UTF8&amp;linkCode=li3&amp;tag=5pi-21&amp;linkId=b0227785164e228e852a35fc66c69e4a&amp;language=de_DE\" target=\"_blank\"><img border=\"0\" src=\"//ws-eu.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=B082BR71DY&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=DE&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=5pi-21&amp;language=de_DE\"></a><img src=\"https://ir-de.amazon-adsystem.com/e/ir?t=5pi-21&amp;language=de_DE&amp;l=li3&amp;o=3&amp;a=B082BR71DY\" width=\"1\" height=\"1\" border=\"0\" alt=\"\" style=\"border:none !important; margin:0px !important;\">\n  </p>\n</div>\nAlso bought patch panel, PDU and a tray to mount the non-rackable equipment.\n<p>Finally all my equipment is nice and tidy contained in the cabinate with just\ntwo uplink connect, the link to the other rooms and a power input draining\ntypically around 60W.</p>\n<h2 id=\"kubernetes-storage\" style=\"position:relative;\"><a href=\"#kubernetes-storage\" aria-label=\"kubernetes storage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubernetes Storage</h2>\n<p>The Kubernetes setup itself hasn’t changed much since my first blog article about <a href=\"/2019/05/10/k8s-on-openwrt/\">Kubernetes on\nOpenWrt</a>. To make use of the new storage I’ve\ndecided to run <a href=\"https://wiki.debian.org/ZFS\">ZFS</a> and use <a href=\"https://docs.openebs.io/docs/next/localpv.html\">OpenEBS’ Local\nPV</a> provisionier. As the name\nimplies, this is not a networking filesystem. Your pods effectivly get pinned to\nwhereever the PV gets created. That means in my case, all pods requesting\nstorage end up on this server. Still much better than using static hostPath\nmounts as I did before and more appropriate than a brittle network filesystem.\nBut I might explore that eventually.</p>\n<h2 id=\"next-software\" style=\"position:relative;\"><a href=\"#next-software\" aria-label=\"next software permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next: Software</h2>\n<p>In the next part of this series I’ll talk about what I spent most time on in\nthis iteration: Using <a href=\"\">jsonnet</a> and\n<a href=\"https://jsonnet-libs.github.io/k8s-alpha/\">k8s-alpha</a> to generate all\nconfiguration in a way that is hopefully reusable on any Kubernetes home (lab)\nsetup. Stay tuned!</p>","frontmatter":{"title":"Kubernetes at Home: Hardware","date":"May 11, 2021","image":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAECBAMF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAHBW3KWFievuM9IFH//xAAcEAACAgIDAAAAAAAAAAAAAAABAgARAxQSITH/2gAIAQEAAQUC5XG8XsErdmBDQRSmrimpin//xAAVEQEBAAAAAAAAAAAAAAAAAAAQAf/aAAgBAwEBPwEp/8QAFREBAQAAAAAAAAAAAAAAAAAAEAH/2gAIAQIBAT8BIf/EABsQAAICAwEAAAAAAAAAAAAAAAAREDEBITJB/9oACAEBAAY/AtjvB5Cho5KP/8QAHhAAAwABBAMAAAAAAAAAAAAAAAERITFBUWFxkdH/2gAIAQEAAT8hd4zvhmKUuaaCZIg1grtVuOrt8Q0pF4Wiavo7/s//2gAMAwEAAgADAAAAEJfgPP/EABcRAQADAAAAAAAAAAAAAAAAAAEAEBH/2gAIAQMBAT8QWa2//8QAGBEBAQADAAAAAAAAAAAAAAAAAQAQEVH/2gAIAQIBAT8QDlonj//EAB4QAQADAAEFAQAAAAAAAAAAAAEAESFBEDFRYXGR/9oACAEBAAE/EKsIOWn5sAIo1prwl5KF2OAlMfN1T62CyXc2x9XKAwM1CX5qO7B6vTh9F//Z","width":1200,"height":1200,"src":"/static/b65430bbc3db885e329c7095246c11f7/ebdd7/rack.jpg","srcSet":"/static/b65430bbc3db885e329c7095246c11f7/ebdd7/rack.jpg 1x,\n/static/b65430bbc3db885e329c7095246c11f7/b9876/rack.jpg 1.5x,\n/static/b65430bbc3db885e329c7095246c11f7/1dd11/rack.jpg 2x"}}}}}},"pageContext":{"slug":"/2021/05/11/homelab-upgrades-hardware/","previous":{"fields":{"slug":"/2020/05/01/kubernetes-native-ci-with-argo/"},"frontmatter":{"title":"Kubernetes Native CI With Argo"}},"next":{"fields":{"slug":"/2024/aws-gh-actions/"},"frontmatter":{"title":"Build securely with Github Actions and ECR using OpenID Connect"}}}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017/04/17/selenium-webdriver-chromedriver-nightwatch-chrome-headless/","result":{"data":{"site":{"siteMetadata":{"title":"5π Consulting","author":"Johannes 'fish' Ziemke"}},"markdownRemark":{"id":"13e2a570-fede-5a44-8a2a-551bdaf4cc93","html":"<p>What I always find hardest to figure it when it comes to unknown systems, it’s ‘how things fit together’. These project might have great documentation, but how the ecosystem plays together is usually left as an exercise for the reader.\nThis happened to me again when diving into frontend testing. I figured out how to get nightwatch+selenium-standalone+chromedriver+chrome working somehow, without fully understanding each part in the puzzle. I went with Nightwatch because I like the syntax and it seems one of the obvious options nowadays. That works until I updated some dependencies and broke everything again. So I took some time to figure out how these things fit together and what is really needed for me tests.\nI’ve learned that Selenium is the godmother of modern frontend testing. It’s a framework with bindings for multiple languages. To decouple the server from the actual browsers, it invented “Selenium RC” as a protocol. That lead to the development of the WebDriver W3C standard which replaces Selenium RC is newer versions and is implemented for the most common browsers (Chrome -> Chromedriver, Firefox -> FirefoxDriver).</p>\n<h2 id=\"nightwatch-without-selenium\" style=\"position:relative;\"><a href=\"#nightwatch-without-selenium\" aria-label=\"nightwatch without selenium permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nightwatch without Selenium</h2>\n<p>Apparently WebDriver is also used for talking <em>to</em> Selenium. I think this is called ‘hub’ or something, that’s about as deep as my ‘deep dive’ gets for now. Either way, this makes the big picture look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Nightwatch -[webdriver]-&gt; Selenium -[webdriver]-&gt; Chromedriver -&gt; Chrome</code></pre></div>\n<p>Selenium comes in a server and standalone flavor, where the server apparently is only used for grid based testing where you would have a bunch of Selenium nodes running on different systems. Turns out, if you don’t need grid based testing or support for legacy browsers which don’t provide WebDriver adapter, there is little use for Selenium after all.</p>\n<p>Fortunately you can make Nightwatch talk directly to Chromedriver. This requires start<em>processto be set to false and selenium</em>host/_port to point the address of Chromedriver:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n  &quot;output_folder&quot;: false,\n  &quot;src_folders&quot;: [&quot;tests&quot;],\n  &quot;selenium&quot;: {\n    &quot;start_process&quot;: false\n  },\n  &quot;test_settings&quot;: {\n    &quot;default&quot;: {\n      &quot;selenium_host&quot;: &quot;127.0.0.1&quot;,\n      &quot;selenium_port&quot;: &quot;9515&quot;,\n      &quot;screenshots&quot;: {\n        &quot;enabled&quot;: true,\n        &quot;on_failure&quot;: true,\n        &quot;on_error&quot; : true,\n        &quot;path&quot;: &quot;results/screenshots&quot;\n      },\n      &quot;desiredCapabilities&quot;: {\n        &quot;browserName&quot;: &quot;chrome&quot;,\n        &quot;javascriptEnabled&quot; : true,\n        &quot;acceptSslCerts&quot; : true,\n        &quot;chromeOptions&quot; : {\n          &quot;args&quot;: [\n            &quot;--no-sandbox&quot;,\n            &quot;start-fullscreen&quot;,\n            &quot;window-size=1280,800&quot;\n          ]\n        }\n      },\n      &quot;launch_url&quot;: &quot;http://app&quot;\n    }\n  }\n}</code></pre></div>\n<p>The only caveat being, you need to run Chromedriver manually. I run all this in a Docker container with a entrypoint like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Xvfb :23 &amp;\nchromedriver --port=9515 --url-base=/wd/hub &amp;\nwhile ! curl localhost:9515; do echo -n .; sleep 1; done\nnightwatch</code></pre></div>\n<h2 id=\"chrome-headless\" style=\"position:relative;\"><a href=\"#chrome-headless\" aria-label=\"chrome headless permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chrome Headless</h2>\n<p>Recently Chrome got native support for running headless, controlled via a remote debugging API. Apparently this could further simplify things, but I couldn’t figure out in reasonable time what exactly it would replace. I suspected it would mean that chrome natively talks webdriver, but I can’t find anything about that in the sparse documentation and this issues sound like.\nWhich brings me to my initial observation: Figuring out how a thing works is hard, figuring out how things work <em>together</em> is so much harder. Let’s all keep that in mind.</p>","frontmatter":{"title":"Frontend Testing Zoo - Or, Nightwatch without Selenium","date":"April 17, 2017","image":null}}},"pageContext":{"slug":"/2017/04/17/selenium-webdriver-chromedriver-nightwatch-chrome-headless/","previous":{"fields":{"slug":"/2016/11/20/15-producation-grade-kubernetes-cluster/"},"frontmatter":{"title":"$15 Production Kubernetes Cluster on DigitalOcean"}},"next":{"fields":{"slug":"/2017/11/09/use-prometheus-vector-matching-to-get-kubernetes-utilization-across-any-pod-label/"},"frontmatter":{"title":"Use Prometheus Vector Matching to get Kubernetes Utilization across any Pod Label"}}}},"staticQueryHashes":[]}
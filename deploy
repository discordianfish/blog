#!/bin/bash
set -euo pipefail
dir=$1

REF=$(git rev-parse HEAD)
trap "git reset --hard $REF" EXIT

grep -v ^public .gitignore > x
mv x .gitignore

git add public/
git commit -m "Updating gh-pages" "$dir"

git subtree split --prefix "$dir" -b gh-pages
git push -f origin gh-pages:gh-pages
